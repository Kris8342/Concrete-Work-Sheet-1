<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Concrete Job Form</title>
  <style>
    /* ===== SCREEN STYLES ===== */
    body {
      font-family: Arial, sans-serif;
      margin: 20px;
      line-height: 1.5;
    }
    .form-container {
      max-width: 900px;
      margin: 0 auto;
      padding: 2px;
      background: #f9f9f9;
      border: 1px solid #ccc;
      border-radius: 6px;
    }
    .header {
      display: flex;
      flex-wrap: wrap;
      gap: 20px;
      margin-bottom: 18px;
      /* Prevent header break */
      page-break-inside: avoid;
    }
    .input-group {
      display: flex;
      align-items: center;
      gap: 8px;
      font-size: 15px;
    }
    label {
      font-weight: bold;
    }
    .input-field {
      border: none;
      border-bottom: 1px solid #333;
      padding: 4px;
      width: 200px;
      font-size: 15px;
    }
    .section-title {
      font-size: 18px;
      font-weight: bold;
      margin: 20px 0 10px;
      border-bottom: 2px solid #333;
      padding-bottom: 2px;
      display: flex;
      align-items: center;
      justify-content: space-between;
    }
    .subsection-title {
      font-size: 16px;
      font-weight: bold;
      margin: 15px 0 8px;
    }
    table {
      width: 100%;
      border-collapse: collapse;
      margin-bottom: 15px;
      font-size: 14px;
    }
    th, td {
      border: 1px solid #ddd;
      padding: 2px;
      text-align: left;
      vertical-align: top;
    }
    th {
      background: #f2f2f2;
      font-weight: bold;
    }
    .checkbox-group {
      display: flex;
      flex-wrap: wrap;
      gap: 15px;
      margin-bottom: 14px;
    }
    .checkbox-item {
      display: flex;
      align-items: center;
      gap: 5px;
      font-size: 14px;
    }
    .section {
      background: #fff;
      border: 1px solid #ddd;
      padding: 15px;
      margin-bottom: 20px;
      border-radius: 5px;
      page-break-inside: avoid;
    }
    .remove-section {
      background: #f44336;
      color: #fff;
      border: none;
      border-radius: 4px;
      padding: 5px 10px;
      cursor: pointer;
      float: right;
    }
    textarea {
      width: 100%;
      height: 80px;
      border: 1px solid #ddd;
      padding: 8px;
      resize: vertical;
    }
    .counter-group {
      display: flex;
      gap: 6px;
    }
    .counter-group input {
      width: 70px;
    }
    .btn {
      padding: 8px 15px;
      border: none;
      border-radius: 4px;
      color: #fff;
      font-size: 14px;
      cursor: pointer;
      margin: 10px 10px 0 0;
    }
    .btn-green {
      background: #4caf50;
    }
    .btn-blue {
      background: #2196f3;
    }
    .btn-toggle {
      background: #607d8b;
      padding: 6px 10px;
      font-size: 13px;
    }
    .no-print {
      display: inline-block;
    }
    /* Wrap toggle-able sections */
    .toggle-target {
      transition: max-height 0.3s ease;
      overflow: hidden;
    }
    
    /* ===== PRINT STYLES (one-page) ===== */
    @media print {
      @page {
        size: letter portrait;
        margin: 0.3in;
      }
      html, body {
        width: 100%;
        height: 100%;
        margin: 0;
        padding: 0;
        font-size: 10px;
        line-height: 1.2;
        zoom: 0.75;
      }
      .no-print,
      .remove-section,
      .btn-toggle {
        display: none !important;
      }
      .form-container {
        border: none;
        padding: 0;
        margin: 0;
      }
      table {
        font-size: 9px;
        margin-bottom: 4px;
      }
      th, td {
        padding: 3px;
      }
      label,
      th,
      td,
      input,
      select,
      textarea {
        font-size: 9px !important;
      }
      .section-title {
        font-size: 12px !important;
        margin: 6px 0 4px !important;
        padding-bottom: 2px !important;
      }
      .subsection-title {
        font-size: 11px !important;
        margin: 4px 0 2px !important;
      }
      .input-group,
      .checkbox-group,
      .section {
        margin-bottom: 4px !important;
        padding: 4px !important;
      }
      .counter-group input {
        width: 40px !important;
      }
      textarea {
        height: 50px !important;
      }
      .section {
        page-break-inside: avoid;
      }
      /* Optimized table layout */
      td input,
      td select,
      td textarea {
        width: 100% !important;
        padding: 2px !important;
      }
      .checkbox-item label {
        margin-left: 2px;
      }
    }
  </style>
</head>
<body>
  <div class="form-container" id="form-root" role="form" aria-label="Concrete Job Form">
    <!-- HEADER -->
    <div class="header">
      <div class="input-group">
        <label for="name">Name / Nombre:</label>
        <input id="name" class="input-field" type="text" placeholder="" aria-label="Name or Nombre" />
      </div>
      <div class="input-group">
        <label for="date">Date Poured / Fecha Vaciado:</label>
        <input id="date" class="input-field" type="text" placeholder="" aria-label="Date Poured or Fecha Vaciado" />
      </div>
      <div class="input-group" style="flex:1 1 100%;">
        <label for="address">Job Address / Dirección del Trabajo:</label>
        <input id="address" class="input-field" style="width:400px" type="text" placeholder="" aria-label="Job Address or Dirección del Trabajo" />
      </div>
      <div class="input-group" style="flex:1 1 100%;">
        <label for="customer">Customer / Cliente:</label>
        <input id="customer" class="input-field" style="width:400px" type="text" placeholder="" aria-label="Customer or Cliente" />
      </div>
    </div>

    <!-- FOOTING SECTIONS -->
    <div id="sections-container">
      <div class="section" id="section-1">
        <button
          class="remove-section no-print"
          onclick="removeSection(this.parentNode)"
          aria-label="Remove Footing Section 1"
          type="button"
        >
          Remove
        </button>
        <div class="section-title" id="section-title-1" aria-level="2" role="heading">
          Footing Section / Sección de Cimentación 1
        </div>

        <!-- Length / Width / Depth -->
        <table>
          <tr>
            <th>Length (ft) / Largo (pies)</th>
            <th>Width (in) / Ancho (pulg)</th>
            <th>Depth (in) / Profundidad (pulg)</th>
          </tr>
          <tr>
            <td>
              <div class="counter-group">
                <input type="number" step="100" min="0" placeholder=""
                  aria-label="Length in feet" oninput="validateNonNegative(this)" />
              </div>
            </td>
            <td>
              <input type="number" step="6" min="0" placeholder=""
                aria-label="Width in inches" oninput="validateNonNegative(this)" />
            </td>
            <td>
              <input type="number" step="6" min="0" placeholder=""
                aria-label="Depth in inches" oninput="validateNonNegative(this)" />
            </td>
          </tr>
        </table>

        <!-- Uprights -->
        <table>
          <tr>
            <th colspan="2">Uprights / Verticales</th>
            <th>Length (ft) / Largo (pies)</th>
          </tr>
          <tr>
            <td style="width:120px;">Quantity / Cantidad</td>
            <td>
              <input type="number" step="5" min="0" placeholder=""
                aria-label="Uprights Quantity" oninput="validateNonNegative(this)" />
            </td>
            <td>
              <input type="number" step="1" min="0" placeholder=""
                aria-label="Uprights Length in feet" oninput="validateNonNegative(this)" />
            </td>
          </tr>
        </table>

        <!-- Crossbars -->
        <table>
          <tr>
            <th colspan="2">Crossbars / Travesaños</th>
            <th>Length (ft) / Largo (pies)</th>
          </tr>
          <tr>
            <td style="width:120px;">Quantity / Cantidad</td>
            <td>
              <input type="number" step="5" min="0" placeholder=""
                aria-label="Crossbars Quantity" oninput="validateNonNegative(this)" />
            </td>
            <td>
              <input type="number" step="1" min="0" placeholder=""
                aria-label="Crossbars Length in feet" oninput="validateNonNegative(this)" />
            </td>
          </tr>
        </table>

        <!-- Mat Selection -->
        <div class="checkbox-group" role="group" aria-label="Mat Selection Single or Double">
          <div class="checkbox-item">
            <input id="single-mat-1" name="mat-type-1" type="radio" aria-label="Single Mat / Malla Simple" />
            <label for="single-mat-1">Single Mat / Malla Simple</label>
          </div>
          <div class="checkbox-item">
            <input id="double-mat-1" name="mat-type-1" type="radio" aria-label="Double Mat / Malla Doble" />
            <label for="double-mat-1">Double Mat / Malla Doble</label>
          </div>
        </div>

        <!-- Rebar -->
        <table>
          <tr>
            <th>Rebar Qty / Cant. Varilla</th>
            <th>Size / Tamaño</th>
          </tr>
          <tr>
            <td>
              <div class="counter-group">
                <input type="number" step="10" min="0" placeholder=""
                  aria-label="Rebar Quantity" oninput="validateNonNegative(this)" />
              </div>
            </td>
            <td>
              <select aria-label="Rebar Size">
                <option value="">Select Size</option>
                <option>#4</option>
                <option>#5</option>
                <option>#6</option>
                <option>#7</option>
                <option>#8</option>
                <option>#9</option>
                <option>#10</option>
              </select>
            </td>
          </tr>
        </table>

        <!-- Bulkheads -->
        <table>
          <tr>
            <th>Bulkheads / Mamparos</th>
            <th>Qty / Cantidad</th>
            <th>Height / Altura</th>
          </tr>
          <tr>
            <td></td>
            <td>
              <input type="number" step="1" min="0" placeholder=""
                aria-label="Bulkheads Quantity" oninput="validateNonNegative(this)" />
            </td>
            <td>
              <input type="number" step="0.01" min="0" placeholder=""
                aria-label="Bulkheads Height" oninput="validateNonNegative(this)" />
            </td>
          </tr>
        </table>

        <!-- Piers -->
        <table>
          <tr>
            <th>Piers Qty / Cant. Pilares</th>
            <th>Size / Tamaño</th>
            <th>Custom / Pers.</th>
          </tr>
          <tr>
            <td>
              <input type="number" step="1" min="0" placeholder=""
                aria-label="Piers Quantity" oninput="validateNonNegative(this)" />
            </td>
            <td>
              <select id="piersize-1" aria-label="Pier Size" onchange="toggleCustomSize(this)">
                <option value="">Select Size</option>
                <option>2' x 2' x 12"</option>
                <option>3' x 3' x 12"</option>
              </select>
            </td>
            <td class="checkbox-item">
              <input type="checkbox" id="piercustom-1" aria-label="Custom Size / Tamaño Pers." onchange="enableCustomInput(this)" />
              <label for="piercustom-1">Custom Size / Tamaño Pers.</label>
              <input type="text" id="piercustominput-1" disabled style="width:120px" placeholder="" aria-label="Custom Pier Size Input" />
            </td>
          </tr>
        </table>

        <!-- Fireplace & Porch Pad -->
        <div class="subsection-title">Fireplace / Chimenea</div>
        <input type="text" style="width:100%;margin-bottom:10px" placeholder=""
          aria-label="Fireplace or Chimenea" />
        <div class="subsection-title">Porch Pad / Base Porche</div>
        <input type="text" style="width:100%;margin-bottom:10px" placeholder=""
          aria-label="Porch Pad or Base Porche" />

        <!-- Additional Materials -->
        <div class="subsection-title">Additional Materials / Materiales Ad.</div>
        <table>
          <tr>
            <th>Item / Artículo</th>
            <th>Qty / Cantidad</th>
            <th>Notes / Notas</th>
          </tr>
          <tr>
            <td>
              <input type="text" placeholder="" aria-label="Additional Material Item 1" />
            </td>
            <td>
              <input type="number" step="2" min="0" placeholder="" aria-label="Additional Material Quantity 1" oninput="validateNonNegative(this)" />
            </td>
            <td>
              <input type="text" placeholder="" aria-label="Additional Material Notes 1" />
            </td>
          </tr>
          <tr>
            <td>
              <input type="text" placeholder="" aria-label="Additional Material Item 2" />
            </td>
            <td>
              <input type="number" step="1" min="0" placeholder="" aria-label="Additional Material Quantity 2" oninput="validateNonNegative(this)" />
            </td>
            <td>
              <input type="text" placeholder="" aria-label="Additional Material Notes 2" />
            </td>
          </tr>
          <tr>
            <td>
              <input type="text" placeholder="" aria-label="Additional Material Item 3" />
            </td>
            <td>
              <input type="number" step="1" min="0" placeholder="" aria-label="Additional Material Quantity 3" oninput="validateNonNegative(this)" />
            </td>
            <td>
              <input type="text" placeholder="" aria-label="Additional Material Notes 3" />
            </td>
          </tr>
        </table>

        <!-- Section Notes -->
        <div class="subsection-title">Section Notes / Notas Sección</div>
        <textarea placeholder="" aria-label="Section Notes"></textarea>
      </div>
    </div>

    <!-- ADD / COUNT SECTIONS -->
    <button class="btn btn-blue no-print" onclick="addSection()" type="button" aria-label="Add Footing Section">
      Add Section / Agregar Sección
    </button>
    <div class="section-title" aria-level="2" role="heading">
      Number of Sections / Número de Secciones:
    </div>
    <div class="checkbox-group" id="section-count-group" role="radiogroup" aria-label="Number of Sections">
      <!-- Section count radios generated by script -->
    </div>

    <!-- CONCRETE INFO -->
    <div class="section-title" aria-level="2" role="heading">Concrete Info / Info de Concreto</div>
    <div class="checkbox-group" role="radiogroup" aria-label="Concrete Company">
      <div class="checkbox-item">
        <input id="imi" name="concrete-company" type="radio" onclick="updateConcreteCompany('imi')" aria-label="IMI Concrete Company" />
        <label for="imi">IMI</label>
      </div>
      <div class="checkbox-item">
        <input id="srm" name="concrete-company" type="radio" onclick="updateConcreteCompany('srm')" aria-label="SRM Concrete Company" />
        <label for="srm">SRM</label>
      </div>
      <div class="input-group" style="flex:1;">
        <label for="other-company">Other / Otro:</label>
        <input id="other-company" class="input-field" type="text" oninput="updateConcreteCompany('other')" placeholder=""
          aria-label="Other Concrete Company" />
      </div>
    </div>
    <table>
      <tr>
        <th>Yards Poured / Yardas Vertidas</th>
      </tr>
      <tr>
        <td>
          <div class="counter-group">
            <input id="yards-tens" type="number" step="10" min="0" placeholder="" aria-label="Yards Poured" oninput="validateNonNegative(this)" />
          </div>
        </td>
      </tr>
    </table>
    <table>
      <tr>
        <th>Additives / Aditivos</th>
        <th>Strength (psi) / Resistencia (psi)</th>
      </tr>
      <tr>
        <td>
          <input id="additives" class="input-field" type="text" style="width:100%" placeholder="" aria-label="Additives" />
        </td>
        <td>
          <input id="strength" type="number" step="500" min="3000" placeholder="" aria-label="Strength PSI" oninput="validateMinValue(this,3000)" />
        </td>
      </tr>
    </table>

    <!-- PUMP CO. -->
    <div class="section-title" aria-level="2" role="heading">Pump Co. / Empresa Bomba</div>
    <div class="checkbox-group" role="radiogroup" aria-label="Pump Company">
      <div class="checkbox-item">
        <input id="pump-cpp" name="pump-company" type="radio" onclick="updatePumpCompany('cpp')" aria-label="CPP Pump Company" />
        <label for="pump-cpp">CPP</label>
      </div>
      <div class="checkbox-item">
        <input id="pump-brundage" name="pump-company" type="radio" onclick="updatePumpCompany('brundage')" aria-label="Brundage Pump Company" />
        <label for="pump-brundage">Brundage</label>
      </div>
      <div class="input-group" style="flex:1;">
        <label for="pump-other">Other / Otro:</label>
        <input id="pump-other" class="input-field" type="text" oninput="updatePumpCompany('other')" placeholder="" aria-label="Other Pump Company" />
      </div>
    </div>

    <!-- CREW INFO (Toggleable) -->
    <div class="section-title" aria-level="2" role="heading">
      Crew Info / Info del Equipo
      <button class="btn btn-toggle no-print" data-target="crew-section" type="button">Hide</button>
    </div>
    <div id="crew-section" class="toggle-target">
      <table id="crew-table" aria-label="Crew Information">
        <tr>
          <th>Name / Nombre</th>
          <th>Role / Rol</th>
          <th>Hours / Horas</th>
        </tr>
        <tr>
          <td><input type="text" placeholder="" aria-label="Crew Member Name" /></td>
          <td><input type="text" placeholder="" aria-label="Crew Member Role" /></td>
          <td><input type="number" step="0.5" placeholder="" aria-label="Crew Member Hours" oninput="validateNonNegative(this)" /></td>
        </tr>
        <tr>
          <td><input type="text" placeholder="" aria-label="Crew Member Name" /></td>
          <td><input type="text" placeholder="" aria-label="Crew Member Role" /></td>
          <td><input type="number" step="0.5" placeholder="" aria-label="Crew Member Hours" oninput="validateNonNegative(this)" /></td>
        </tr>
        <tr>
          <td><input type="text" placeholder="" aria-label="Crew Member Name" /></td>
          <td><input type="text" placeholder="" aria-label="Crew Member Role" /></td>
          <td><input type="number" step="0.5" placeholder="" aria-label="Crew Member Hours" oninput="validateNonNegative(this)" /></td>
        </tr>
      </table>
      <button class="btn btn-blue no-print" onclick="addCrewMember()" type="button" aria-label="Add Crew Member">
        Add Crew Member / Agregar Miembro
      </button>
    </div>


    <!-- EQUIP HRS / DESC -->
    <div class="section-title" aria-level="2" role="heading">Equipment Hours & Description / Horas y Descripción</div>
    <table aria-label="Equipment Hours and Description">
      <tr>
        <th>Equipment</th>
        <th>Hours</th>
        <th>Description</th>
      </tr>
      <tr>
        <td>MiniX</td>
        <td><input type="number" step="0.5" placeholder="" aria-label="MiniX Hours" oninput="validateNonNegative(this)" /></td>
        <td><input type="text" placeholder="" aria-label="MiniX Description" /></td>
      </tr>
      <tr>
        <td>Hammer</td>
        <td><input type="number" step="0.5" placeholder="" aria-label="Hammer Hours" oninput="validateNonNegative(this)" /></td>
        <td><input type="text" placeholder="" aria-label="Hammer Description" /></td>
      </tr>
      <tr>
        <td>Skid / Dingo</td>
        <td><input type="number" step="0.5" placeholder="" aria-label="Skid or Dingo Hours" oninput="validateNonNegative(this)" /></td>
        <td><input type="text" placeholder="" aria-label="Skid or Dingo Description" /></td>
      </tr>
      <tr>
        <td>Step Pad</td>
        <td><input type="number" step="0.5" placeholder="" aria-label="Step Pad Hours" oninput="validateNonNegative(this)" /></td>
        <td><input type="text" placeholder="" aria-label="Step Pad Description" /></td>
      </tr>
    </table>

    <!-- SUPPLIES USED -->
    <div class="section-title" aria-level="2" role="heading">Supplies Used / Suministros Usados</div>
    <table aria-label="Supplies Used">
      <tr>
        <th>Supply / Suministro</th>
        <th>Quantity / Notas</th>
      </tr>
      <tr>
        <td>Paint / Pintura</td>
        <td>
          Boxes/Cajas <input type="number" style="width:60px" placeholder="" aria-label="Paint Boxes Quantity" oninput="validateNonNegative(this)" />
          Cans/Latas <input type="number" style="width:60px" placeholder="" aria-label="Paint Cans Quantity" oninput="validateNonNegative(this)" />
        </td>
      </tr>
      <tr>
        <td>Chairs (boxes) / Sillas (cajas)</td>
        <td><input type="number" placeholder="" aria-label="Chairs Boxes Quantity" oninput="validateNonNegative(this)" /></td>
      </tr>
      <tr>
        <td>Grade Pins (boxes) / Pines (cajas)</td>
        <td><input type="number" placeholder="" aria-label="Grade Pins Boxes Quantity" oninput="validateNonNegative(this)" /></td>
      </tr>
      <tr>
        <td>2 × 4 × 16'</td>
        <td><input type="number" placeholder="" aria-label="2x4x16 Quantity" oninput="validateNonNegative(this)" /></td>
      </tr>
      <tr>
        <td>Plywood (sheets) / Contrachapado</td>
        <td><input type="number" placeholder="" aria-label="Plywood Sheets Quantity" oninput="validateNonNegative(this)" /></td>
      </tr>
      <tr>
        <td>Lumber Notes / Notas de Madera</td>
        <td><textarea id="lumber-notes" style="height:100px" placeholder="" aria-label="Lumber Notes"></textarea></td>
      </tr>
    </table>

    <!-- MANAGEMENT JOB CODING (Toggleable) -->
    <div class="section-title" aria-level="2" role="heading">
      Management Job Coding / Cod. Gestión
      <button class="btn btn-toggle no-print" data-target="coding-section" type="button">Hide</button>
    </div>
    <div id="coding-section" class="toggle-target">
      <div class="input-group">
        <label for="builder">Builder / Constructor:</label>
        <input id="builder" class="input-field" type="text" placeholder="" aria-label="Builder or Constructor" />
      </div>
      <div class="input-group">
        <label for="city-county">City/County / Ciudad:</label>
        <input id="city-county" class="input-field" type="text" placeholder="" aria-label="City or County" />
      </div>
      <div class="checkbox-group" role="group" aria-label="Job Type">
        <div class="checkbox-item">
          <input id="job-turnkey" type="checkbox" aria-label="Turnkey Job" />
          <label for="job-turnkey">Turnkey / Llave Mano</label>
        </div>
        <div class="checkbox-item">
          <input id="job-house" type="checkbox" aria-label="House Job" />
          <label for="job-house">House / Casa</label>
        </div>
        <div class="checkbox-item">
          <input id="job-labor" type="checkbox" aria-label="Labor Only Job" />
          <label for="job-labor">Labor Only / Solo O.</label>
        </div>
        <div class="checkbox-item">
          <input id="job-retaining" type="checkbox" aria-label="Retaining Wall Job" />
          <label for="job-retaining">Retaining Wall / Muro</label>
        </div>
      </div>
    </div>

    <!-- ADDITIONAL NOTES (Toggleable) -->
    <div class="section-title" aria-level="2" role="heading">
      Additional Notes / Notas Adicionales
      <button class="btn btn-toggle no-print" data-target="notes-section" type="button">Hide</button>
    </div>
    <div id="notes-section" class="toggle-target">
      <textarea id="additional-notes" placeholder="" aria-label="Additional Notes"></textarea>
    </div>

    <!-- SAVE AS PDF -->
    <button class="btn btn-green no-print" onclick="savePDF()" type="button" aria-label="Save form as PDF">
      Save as PDF / Guardar PDF
    </button>
  </div>

  <!-- html2pdf bundle -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
  <script>
    // Set today's date
    document.getElementById('date').value = new Date().toLocaleDateString();

    // Enter key navigation (skipping textarea)
    document.addEventListener('keydown', (e) => {
      if (e.key === 'Enter' && e.target.tagName !== 'TEXTAREA') {
        e.preventDefault();
        const fields = [...document.querySelectorAll('input:not([type=checkbox]), select, textarea')].filter((el) => el.offsetParent);
        const idx = fields.indexOf(document.activeElement);
        (fields[idx + 1] || fields[0]).focus();
      }
    });

    // Validate number inputs to prevent negative or invalid values
    function validateNonNegative(input) {
      if (input.value !== '' && Number(input.value) < 0) {
        input.value = '';
      }
    }
    // Validate minimum value for inputs such as strength psi
    function validateMinValue(input, min) {
      if (input.value !== '' && Number(input.value) < min) {
        input.value = '';
      }
    }

    // --- TOGGLE SECTIONS ---
    document.addEventListener('click', (e) => {
      if (e.target.matches('.btn-toggle')) {
        const btn = e.target;
        const target = document.getElementById(btn.getAttribute('data-target'));
        if (target) {
          if (target.style.display === 'none') {
            target.style.display = '';
            btn.textContent = 'Hide';
          } else {
            target.style.display = 'none';
            btn.textContent = 'Show';
          }
        }
      }
    });

    // --- SAVE PDF ---
    function savePDF() {
      // Hide non-printable elements
      const ui = document.querySelectorAll('.no-print');
      ui.forEach((el) => (el.style.display = 'none'));

      const element = document.getElementById('form-root');

      // Clone element to preserve original styles
      const clone = element.cloneNode(true);
      clone.style.width = '100%';
      clone.style.overflow = 'visible';
      document.body.appendChild(clone);

      // Inject print-safe styles into clone
      const style = document.createElement('style');
      style.textContent = `
        input, select, textarea {
          background-color: #fff !important;
          color: #000 !important;
          border: 1px solid #ccc !important;
          box-shadow: none !important;
        }
        .input-field {
          background-color: #fff !important;
          border: 1px solid #ccc !important;
        }
        * {
          margin-bottom: 2px !important;
          padding: 2px !important;
          line-height: 1.1 !important;
          font-size: 9px !important;
        }
      `;
      clone.appendChild(style);

      const opt = {
        margin: 0.2,
        filename: 'concrete_job_form.pdf',
        pagebreak: { mode: ['avoid-all', 'css'], before: '.section' },
        html2canvas: {
          scale: 2,
          useCORS: true,
          scrollY: 0,
          windowHeight: clone.scrollHeight
        },
        jsPDF: {
          unit: 'in',
          format: 'letter',
          orientation: 'portrait',
          hotfixes: ['px_scaling']
        }
      };

      html2pdf()
        .set(opt)
        .from(clone)
        .save()
        .then(() => {
          document.body.removeChild(clone);
          ui.forEach((el) => (el.style.display = ''));
        })
        .catch((err) => {
          console.error('PDF generation failed:', err);
          if (document.body.contains(clone)) {
            document.body.removeChild(clone);
          }
          ui.forEach((el) => (el.style.display = ''));
          alert('Failed to generate PDF. Please try again.');
        });
    }

    // --- DYNAMIC SECTIONS (as in the original) ---
    let sectionCount = 1;

    // Generate radio buttons showing the current section count
    function updateSectionCountRadios() {
      const container = document.getElementById('section-count-group');
      container.innerHTML = '';
      for (let i = 1; i <= sectionCount; i++) {
        const id = 'section-count-' + i;
        const radio = document.createElement('input');
        radio.type = 'radio';
        radio.name = 'section-count';
        radio.id = id;
        radio.value = i;
        radio.setAttribute('aria-label', `Select ${i} sections`);
        radio.onclick = () => updateSectionCount(i);
        if (i === sectionCount) radio.checked = true;

        const label = document.createElement('label');
        label.htmlFor = id;
        label.textContent = i;

        const div = document.createElement('div');
        div.className = 'checkbox-item';
        div.appendChild(radio);
        div.appendChild(label);

        container.appendChild(div);
      }
    }

    // Add a new footing section
    function addSection() {
      sectionCount++;
      const t = document.getElementById('section-1').cloneNode(true);
      t.id = 'section-' + sectionCount;
      t.querySelectorAll('input,textarea,select').forEach((el) => {
        if (el.type === 'checkbox' || el.type === 'radio') el.checked = false;
        else el.value = '';
        if (el.tagName === 'SELECT') el.selectedIndex = 0;
      });
      // Update IDs for mat and pier inputs to avoid duplicates in the clone
      ['single-mat-', 'double-mat-', 'piercustom-', 'piercustominput-', 'piersize-'].forEach(
        (pref) => {
          const el = t.querySelector('[id^="' + pref + '"]');
          if (el) {
            el.id = pref + sectionCount;
            if (el.type === 'radio') {
              el.name = 'mat-type-' + sectionCount;
            }
            const lbl = t.querySelector('label[for^="' + pref + '"]');
            if (lbl) lbl.htmlFor = el.id;
          }
        }
      );
      t.querySelector('.section-title').textContent = 'Footing Section / Sección de Cimentación ' + sectionCount;

      // Update aria-label on remove button
      const removeBtn = t.querySelector('.remove-section');
      removeBtn.setAttribute('aria-label', `Remove Footing Section ${sectionCount}`);
      
      // Update section title aria attributes
      const sectionTitle = t.querySelector('.section-title');
      sectionTitle.id = 'section-title-' + sectionCount;

      document.getElementById('sections-container').appendChild(t);
      updateSectionCountRadios();
    }

    // Remove a footing section (ensure at least one remains)
    function removeSection(sec) {
      const all = [...document.querySelectorAll('#sections-container .section')];
      if (all.length === 1) {
        alert('At least one section is required');
        return;
      }
      if (!confirm('Are you sure you want to remove this section?')) return;
      sec.remove();
      renumber();
    }

    // Renumber sections after removal
    function renumber() {
      sectionCount = 0;
      document.querySelectorAll('#sections-container .section').forEach((s, i) => {
        sectionCount = i + 1;
        s.id = 'section-' + sectionCount;
        s.querySelector('.section-title').textContent = 'Footing Section / Sección de Cimentación ' + sectionCount;
        const removeBtn = s.querySelector('.remove-section');
        if (removeBtn) {
          removeBtn.setAttribute('aria-label', `Remove Footing Section ${sectionCount}`);
        }
        ['single-mat-', 'double-mat-', 'piercustom-', 'piercustominput-', 'piersize-'].forEach(
          (pref) => {
            const el = s.querySelector('[id^="' + pref + '"]');
            if (el) {
              el.id = pref + sectionCount;
              if (el.type === 'radio') {
                el.name = 'mat-type-' + sectionCount;
              }
              const lbl = s.querySelector('label[for^="' + pref + '"]');
              if (lbl) lbl.htmlFor = el.id;
            }
          }
        );
        const sectionTitle = s.querySelector('.section-title');
        sectionTitle.id = 'section-title-' + sectionCount;
      });
      updateSectionCountRadios();
    }

    function updateSectionCount(n) {
      document.querySelectorAll('input[name="section-count"]').forEach((c) => (c.checked = false));
      const radio = document.getElementById('section-count-' + n);
      if (radio) radio.checked = true;
      while (sectionCount < n) addSection();
      while (sectionCount > n) {
        if (sectionCount === 1) break;
        document.querySelector('#sections-container .section:last-child').remove();
        sectionCount--;
      }
      updateSectionCountRadios();
    }

    // Custom pier size helpers
    function enableCustomInput(cb) {
      const i = cb.id.split('-')[1];
      const inp = document.getElementById('piercustominput-' + i);
      inp.disabled = !cb.checked;
      if (!cb.checked) inp.value = '';
    }
    function toggleCustomSize(sel) {
      const i = sel.id.split('-')[1];
      const cb = document.getElementById('piercustom-' + i);
      const inp = document.getElementById('piercustominput-' + i);
      cb.checked = false;
      inp.disabled = true;
      inp.value = '';
    }

    // Crew & Equipment rows helpers
    function addCrewMember() {
      const r = document.getElementById('crew-table').insertRow(-1);
      r.innerHTML = '<td><input type="text" placeholder="" aria-label="Crew Member Name" /></td>' +
                    '<td><input type="text" placeholder="" aria-label="Crew Member Role" /></td>' +
                    '<td><input type="number" step="0.5" placeholder="" aria-label="Crew Member Hours" oninput="validateNonNegative(this)" /></td>';
    }
    function addEquipmentRow() {
      const r = document.getElementById('equipment-table').insertRow(-1);
      r.innerHTML = '<td><input type="text" placeholder="" aria-label="Equipment Name" /></td>' +
                    '<td><input type="number" step="0.5" placeholder="" aria-label="Equipment Hours" oninput="validateNonNegative(this)" /></td>' +
                    '<td><input type="text" placeholder="" aria-label="Equipment Notes" /></td>';
    }

    // Single-select helpers for concrete company
    function updateConcreteCompany(c) {
      if (c === 'imi' || c === 'srm') {
        document.getElementById(c).checked = true;
        document.getElementById('other-company').value = '';
      }
    }
    // Single-select helpers for pump company
    function updatePumpCompany(c) {
      if (c === 'cpp' || c === 'brundage') {
        document.getElementById('pump-' + c).checked = true;
        document.getElementById('pump-other').value = '';
      }
    }

    // Initialize section count radios on page load
    updateSectionCountRadios();
  </script>
</body>
</html>
