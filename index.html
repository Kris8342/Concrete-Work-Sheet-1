<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Concrete Job Form</title>
  <style>
    /* ===== SCREEN STYLES ===== */
    body {
      font-family: Arial, sans-serif;
      margin: 15px;
      line-height: 1.5;
    }
    
    .form-container {
      max-width: 900px;
      margin: 0 auto;
      padding: 15px;
      background: #f9f9f9;
      border: 1px solid #ccc;
      border-radius: 6px;
    }
    
    .header {
      display: flex;
      flex-wrap: wrap;
      gap: 12px;
      margin-bottom: 10px; /* Reduced from 18px */
    }
    
    .input-group {
      display: flex;
      align-items: center;
      gap: 6px;
      font-size: 15px;
      flex: 1 1 200px;
    }
    
    label {
      font-weight: bold;
      min-width: max-content;
    }
    
    .input-field {
      border: none;
      border-bottom: 1px solid #333;
      padding: 4px;
      font-size: 15px;
      flex: 1;
    }
    
    .section-title {
      font-size: 18px;
      font-weight: bold;
      margin: 15px 0 8px; /* Reduced top margin */
      border-bottom: 2px solid #333;
      padding-bottom: 4px;
    }
    
    .subsection-title {
      font-size: 16px;
      font-weight: bold;
      margin: 12px 0 6px; /* Reduced margins */
    }
    
    table {
      width: 100%;
      border-collapse: collapse;
      margin-bottom: 12px; /* Reduced */
      font-size: 14px;
      table-layout: fixed;
    }
    
    th, td {
      border: 1px solid #ddd;
      padding: 8px;
      text-align: left;
      vertical-align: top;
      word-break: break-word;
    }
    
    th {
      background: #f2f2f2;
      font-weight: bold;
    }
    
    .checkbox-group {
      display: flex;
      flex-wrap: wrap;
      gap: 12px;
      margin-bottom: 10px; /* Reduced */
    }
    
    .checkbox-item {
      display: flex;
      align-items: center;
      gap: 5px;
      font-size: 14px;
    }
    
    .section {
      background: #fff;
      border: 1px solid #ddd;
      padding: 12px; /* Reduced */
      margin-bottom: 15px; /* Reduced */
      border-radius: 5px;
      page-break-inside: avoid;
    }
    
    .remove-section {
      background: #f44336;
      color: #fff;
      border: none;
      border-radius: 4px;
      padding: 5px 10px;
      cursor: pointer;
      float: right;
      font-size: 13px;
    }
    
    textarea {
      width: 100%;
      height: 80px;
      border: 1px solid #ddd;
      padding: 8px;
      resize: vertical;
      box-sizing: border-box;
    }
    
    .counter-group {
      display: flex;
      gap: 6px;
    }
    
    select.hour-select {
      width: 100%;
      font-size: 14px;
      padding: 4px;
      border: 1px solid #ddd;
      border-radius: 4px;
    }
    
    .btn {
      padding: 8px 15px;
      border: none;
      border-radius: 4px;
      color: #fff;
      font-size: 14px;
      cursor: pointer;
      margin: 10px 10px 0 0;
    }
    
    .btn-green {
      background: #4caf50;
    }
    
    .btn-blue {
      background: #2196f3;
    }
    
    .no-print {
      display: inline-block;
    }
    
    /* Mobile optimizations */
    @media (max-width: 768px) {
      .header {
        flex-direction: column;
        gap: 10px;
      }
      
      .input-group {
        flex: 1 1 100%;
      }
      
      .input-field {
        width: 100%;
      }
      
      table {
        font-size: 12px;
      }
      
      th, td {
        padding: 6px;
      }
      
      .btn {
        width: 100%;
        margin: 5px 0;
      }
    }

    /* ===== PRINT STYLES ===== */
    @media print {
      @page {
        size: letter portrait;
        margin: 0.25in; /* Reduced margin */
      }
      
      html, body {
        width: 100%;
        height: auto;
        margin: 0;
        padding: 0;
        font-size: 10px;
        line-height: 1.2;
      }
      
      .no-print, .remove-section {
        display: none !important;
      }
      
      .form-container {
        border: none;
        padding: 5px !important; /* Reduced */
        margin: 0;
        max-width: 100%;
      }
      
      .header {
        margin-bottom: 5px !important; /* Reduced */
        gap: 5px !important;
      }
      
      table {
        font-size: 8px; /* Reduced */
        margin-bottom: 3px; /* Reduced */
      }
      
      th, td {
        padding: 2px !important; /* Reduced */
      }
      
      label, th, td, input, select, textarea {
        font-size: 8px !important; /* Reduced */
      }
      
      .section-title {
        font-size: 10px !important; /* Reduced */
        margin: 4px 0 3px !important; /* Reduced */
        padding-bottom: 2px !important;
      }
      
      .subsection-title {
        font-size: 9px !important; /* Reduced */
        margin: 3px 0 2px !important; /* Reduced */
      }
      
      .input-group, .checkbox-group {
        margin-bottom: 3px !important; /* Reduced */
      }
      
      .section {
        padding: 6px !important; /* Reduced */
        margin-bottom: 8px !important; /* Reduced */
      }
      
      textarea {
        height: 40px !important; /* Reduced */
      }
    }
  </style>
</head>
<body>
  <div class="form-container" id="form-root">
    <!-- HEADER -->
    <div class="header">
      <div class="input-group">
        <label for="name">Name / Nombre:</label>
        <input id="name" class="input-field" type="text">
      </div>
      
      <div class="input-group">
        <label for="date">Date Poured / Fecha Vaciado:</label>
        <input id="date" class="input-field" type="text">
      </div>
      
      <div class="input-group">
        <label for="address">Job Address / Dirección del Trabajo:</label>
        <input id="address" class="input-field" type="text">
      </div>
      
      <div class="input-group">
        <label for="customer">Customer / Cliente:</label>
        <input id="customer" class="input-field" type="text">
      </div>
    </div>

    <!-- FOOTING SECTIONS -->
    <div id="sections-container">
      <div class="section" id="section-1">
        <button class="remove-section no-print" onclick="removeSection(this.parentNode)">Remove</button>
        <div class="section-title">Footing Section / Sección de Cimentación 1</div>

        <!-- Length / Width / Depth -->
        <table>
          <tr>
            <th>Length (ft) / Largo (pies)</th>
            <th>Width (in) / Ancho (pulg)</th>
            <th>Depth (in) / Profundidad (pulg)</th>
          </tr>
          <tr>
            <td><input type="number" step="100" min="0"></td>
            <td><input type="number" step="6" min="0"></td>
            <td><input type="number" step="6" min="0"></td>
          </tr>
        </table>

        <!-- Uprights -->
        <table>
          <tr>
            <th colspan="2">Uprights / Verticales</th>
            <th>Length (ft) / Largo (pies)</th>
          </tr>
          <tr>
            <td style="width:120px;">Quantity / Cantidad</td>
            <td><input type="number" step="5" min="0"></td>
            <td><input type="number" step="1" min="0"></td>
          </tr>
        </table>

        <!-- Crossbars -->
        <table>
          <tr>
            <th colspan="2">Crossbars / Travesaños</th>
            <th>Length (ft) / Largo (pies)</th>
          </tr>
          <tr>
            <td style="width:120px;">Quantity / Cantidad</td>
            <td><input type="number" step="5" min="0"></td>
            <td><input type="number" step="1" min="0"></td>
          </tr>
        </table>

        <!-- Single / Double Mat -->
        <div class="checkbox-group">
          <div class="checkbox-item">
            <input id="single-mat-1" type="checkbox">
            <label for="single-mat-1">Single Mat / Malla Simple</label>
          </div>
          <div class="checkbox-item">
            <input id="double-mat-1" type="checkbox">
            <label for="double-mat-1">Double Mat / Malla Doble</label>
          </div>
        </div>

        <!-- Rebar -->
        <table>
          <tr>
            <th>Rebar Qty / Cant. Varilla</th>
            <th>Size / Tamaño</th>
          </tr>
          <tr>
            <td><input type="number" step="10" min="0"></td>
            <td>
              <select>
                <option>#4</option>
                <option>#5</option>
                <option>#6</option>
                <option>#7</option>
                <option>#8</option>
                <option>#9</option>
                <option>#10</option>
              </select>
            </td>
          </tr>
        </table>

        <!-- Bulkheads -->
        <table>
          <tr>
            <th>Bulkheads / Mamparos</th>
            <th>Qty / Cantidad</th>
            <th>Height / Altura</th>
          </tr>
          <tr>
            <td></td>
            <td><input type="number" step="1" min="0"></td>
            <td><input type="number" step="0.01" min="0"></td>
          </tr>
        </table>

        <!-- Piers -->
        <table>
          <tr>
            <th>Piers Qty / Cant. Pilares</th>
            <th>Size / Tamaño</th>
            <th>Custom / Pers.</th>
          </tr>
          <tr>
            <td><input type="number" step="1" min="0"></td>
            <td>
              <select id="piersize-1" onchange="toggleCustomSize(this)">
                <option>2' x 2' x 12"</option>
                <option>3' x 3' x 12"</option>
              </select>
            </td>
            <td class="checkbox-item">
              <input type="checkbox" id="piercustom-1" onchange="enableCustomInput(this)">
              <label for="piercustom-1">Custom Size / Tamaño Pers.</label>
              <input type="text" id="piercustominput-1" disabled style="width:120px;">
            </td>
          </tr>
        </table>

        <!-- Fireplace & Porch Pad -->
        <div class="subsection-title">Fireplace / Chimenea</div>
        <input type="text" style="width:100%; margin-bottom:8px;"> <!-- Reduced margin -->
        
        <div class="subsection-title">Porch Pad / Base Porche</div>
        <input type="text" style="width:100%; margin-bottom:8px;"> <!-- Reduced margin -->

        <!-- Additional Materials -->
        <div class="subsection-title">Additional Materials / Materiales Ad.</div>
        <table>
          <tr>
            <th>Item / Artículo</th>
            <th>Qty / Cantidad</th>
            <th>Notes / Notas</th>
          </tr>
          <tr>
            <td><input type="text"></td>
            <td><input type="number" step="2" min="0"></td>
            <td><input type="text"></td>
          </tr>
          <tr>
            <td><input type="text"></td>
            <td><input type="number" step="1" min="0"></td>
            <td><input type="text"></td>
          </tr>
          <tr>
            <td><input type="text"></td>
            <td><input type="number" step="1" min="0"></td>
            <td><input type="text"></td>
          </tr>
        </table>

        <!-- Section Notes -->
        <div class="subsection-title">Section Notes / Notas Sección</div>
        <textarea></textarea>
      </div>
    </div>

    <!-- ADD / COUNT SECTIONS -->
    <button class="btn btn-blue no-print" onclick="addSection()">Add Section / Agregar Sección</button>
    <div class="section-title">Number of Sections / Número de Secciones:</div>
    <div class="checkbox-group" id="section-count-group"></div>

    <!-- CONCRETE INFO -->
    <div class="section-title">Concrete Info / Info de Concreto</div>
    <div class="checkbox-group">
      <div class="checkbox-item">
        <input id="imi" name="concrete-company" type="checkbox" onclick="updateConcreteCompany('imi')">
        <label for="imi">IMI</label>
      </div>
      <div class="checkbox-item">
        <input id="srm" name="concrete-company" type="checkbox" onclick="updateConcreteCompany('srm')">
        <label for="srm">SRM</label>
      </div>
      <div class="input-group">
        <label for="other-company">Other / Otro:</label>
        <input id="other-company" class="input-field" type="text" oninput="updateConcreteCompany('other')">
      </div>
    </div>
    
    <table>
      <tr>
        <th>Yards Poured / Yardas Vertidas</th>
      </tr>
      <tr>
        <td><select class="hour-select" id="yards-poured"></select></td>
      </tr>
    </table>
    
    <table>
      <tr>
        <th>Additives / Aditivos</th>
        <th>Strength (psi) / Resistencia (psi)</th>
      </tr>
      <tr>
        <td><input id="additives" class="input-field" type="text" style="width:100%"></td>
        <td><select class="hour-select" id="strength"></select></td>
      </tr>
    </table>

    <!-- PUMP CO. -->
    <div class="section-title">Pump Co. / Empresa Bomba</div>
    <div class="checkbox-group">
      <div class="checkbox-item">
        <input id="pump-cpp" name="pump-company" type="checkbox" onclick="updatePumpCompany('cpp')">
        <label for="pump-cpp">CPP</label>
      </div>
      <div class="checkbox-item">
        <input id="pump-brundage" name="pump-company" type="checkbox" onclick="updatePumpCompany('brundage')">
        <label for="pump-brundage">Brundage</label>
      </div>
      <div class="input-group">
        <label for="pump-other">Other / Otro:</label>
        <input id="pump-other" class="input-field" type="text" oninput="updatePumpCompany('other')">
      </div>
    </div>

    <!-- CREW INFO -->
    <div class="section-title">Crew Info / Info del Equipo</div>
    <table id="crew-table">
      <tr>
        <th>Name / Nombre</th>
        <th>Role / Rol</th>
        <th>Hours / Horas</th>
      </tr>
      <tr>
        <td><input type="text"></td>
        <td><input type="text"></td>
        <td><select class="hour-select"></select></td>
      </tr>
      <tr>
        <td><input type="text"></td>
        <td><input type="text"></td>
        <td><select class="hour-select"></select></td>
      </tr>
      <tr>
        <td><input type="text"></td>
        <td><input type="text"></td>
        <td><select class="hour-select"></select></td>
      </tr>
    </table>
    <button class="btn btn-blue no-print" onclick="addCrewMember()">Add Crew Member / Agregar Miembro</button>

    <!-- EQUIPMENT USED -->
    <div class="section-title">Equipment Used / Equipo Usado</div>
    <table id="equipment-table">
      <tr>
        <th>Equipment / Equipo</th>
        <th>Hours / Horas</th>
        <th>Notes / Notas</th>
      </tr>
      <tr>
        <td><input type="text"></td>
        <td><select class="hour-select"></select></td>
        <td><input type="text"></td>
      </tr>
      <tr>
        <td><input type="text"></td>
        <td><select class="hour-select"></select></td>
        <td><input type="text"></td>
      </tr>
    </table>
    <button class="btn btn-blue no-print" onclick="addEquipmentRow()">Add Equipment / Agregar Equipo</button>

    <!-- EQUIP HRS / DESC -->
    <div class="section-title">Equipment Hours & Description / Horas y Descripción</div>
    <table>
      <tr>
        <th>Equipment</th>
        <th>Hours</th>
        <th>Description</th>
      </tr>
      <tr>
        <td>MiniX</td>
        <td><select class="hour-select"></select></td>
        <td><input type="text"></td>
      </tr>
      <tr>
        <td>Hammer</td>
        <td><select class="hour-select"></select></td>
        <td><input type="text"></td>
      </tr>
      <tr>
        <td>Skid / Dingo</td>
        <td><select class="hour-select"></select></td>
        <td><input type="text"></td>
      </tr>
      <tr>
        <td>Step Pad</td>
        <td><select class="hour-select"></select></td>
        <td><input type="text"></td>
      </tr>
    </table>

    <!-- SUPPLIES USED -->
    <div class="section-title">Supplies Used / Suministros Usados</div>
    <table>
      <tr>
        <th>Supply / Suministro</th>
        <th>Quantity / Cantidad</th>
      </tr>
      <tr>
        <td>Paint / Pintura</td>
        <td>
          Boxes/Cajas <select class="hour-select"></select>
          Cans/Latas <select class="hour-select"></select>
        </td>
      </tr>
      <tr>
        <td>Chairs (boxes) / Sillas (cajas)</td>
        <td><select class="hour-select"></select></td>
      </tr>
      <tr>
        <td>Grade Pins (boxes) / Pines (cajas)</td>
        <td><select class="hour-select"></select></td>
      </tr>
      <tr>
        <td>2 × 4 × 16'</td>
        <td><select class="hour-select"></select></td>
      </tr>
      <tr>
        <td>Plywood (sheets) / Contrachapado</td>
        <td><select class="hour-select"></select></td>
      </tr>
      <tr>
        <td>Lumber Notes / Notas de Madera</td>
        <td><textarea id="lumber-notes" style="height:80px"></textarea></td> <!-- Reduced height -->
      </tr>
    </table>

    <!-- MANAGEMENT JOB CODING -->
    <div class="section-title">Management Job Coding / Cod. Gestión</div>
    <div class="input-group">
      <label for="builder">Builder / Constructor:</label>
      <input id="builder" class="input-field" type="text">
    </div>
    <div class="input-group">
      <label for="city-county">City/County / Ciudad:</label>
      <input id="city-county" class="input-field" type="text">
    </div>
    <div class="checkbox-group">
      <div class="checkbox-item">
        <input id="job-turnkey" type="checkbox">
        <label for="job-turnkey">Turnkey / Llave Mano</label>
      </div>
      <div class="checkbox-item">
        <input id="job-house" type="checkbox">
        <label for="job-house">House / Casa</label>
      </div>
      <div class="checkbox-item">
        <input id="job-labor" type="checkbox">
        <label for="job-labor">Labor Only / Solo O.</label>
      </div>
      <div class="checkbox-item">
        <input id="job-retaining" type="checkbox">
        <label for="job-retaining">Retaining Wall / Muro</label>
      </div>
    </div>

    <!-- ADDITIONAL NOTES -->
    <div class="section-title">Additional Notes / Notas Adicionales</div>
    <textarea id="additional-notes" style="height:100px"></textarea> <!-- Reduced height -->

    <!-- SAVE AS PDF -->
    <button class="btn btn-green no-print" onclick="savePDF()">Save as PDF / Guardar PDF</button>
  </div>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
  <script>
    // Generate dropdown options for hours/quantities
    function generateHourOptions() {
      let options = '';
      for (let i = 0; i <= 200; i++) {
        let val = (i * 0.5).toFixed(1);
        options += `<option value="${val}">${val}</option>`;
      }
      return options;
    }

    // Initialize form on load
    document.addEventListener('DOMContentLoaded', () => {
      // Set today's date
      document.getElementById('date').value = new Date().toLocaleDateString();
      
      // Populate all hour-select dropdowns
      const hourSelects = document.querySelectorAll('select.hour-select');
      const options = generateHourOptions();
      hourSelects.forEach(sel => {
        sel.innerHTML = options;
        sel.value = '0';
      });
    });

    // Enter key navigation
    document.addEventListener('keydown', e => {
      if (e.key === 'Enter' && e.target.tagName !== 'TEXTAREA') {
        e.preventDefault();
        const inputs = [...document.querySelectorAll('input:not([type=checkbox]), select, textarea')]
          .filter(el => el.offsetParent);
        const idx = inputs.indexOf(document.activeElement);
        (inputs[idx + 1] || inputs[0]).focus();
      }
    });

    // Save as PDF function
    function savePDF() {
      // Hide non-printable elements
      const ui = document.querySelectorAll('.no-print');
      ui.forEach(el => el.style.display = 'none');
      
      const element = document.getElementById('form-root');
      
      // Create a clone to preserve original styles
      const clone = element.cloneNode(true);
      clone.style.width = '100%';
      clone.style.overflow = 'visible';
      document.body.appendChild(clone);
      
      const opt = {
        margin: 0.25, // Reduced margin
        filename: 'concrete_job_form.pdf',
        pagebreak: { mode: ['avoid-all', 'css'], before: '.section' },
        html2canvas: {
          scale: 2,
          useCORS: true,
          scrollY: 0,
          windowHeight: clone.scrollHeight
        },
        jsPDF: { 
          unit: 'in', 
          format: 'letter', 
          orientation: 'portrait',
          hotfixes: ['px_scaling']  // Fixes pixel scaling issues
        }
      };

      // Generate PDF
      html2pdf()
        .set(opt)
        .from(clone)
        .save()
        .then(() => {
          // Clean up and restore UI
          document.body.removeChild(clone);
          ui.forEach(el => el.style.display = '');
        })
        .catch(err => {
          console.error('PDF generation failed:', err);
          document.body.removeChild(clone);
          ui.forEach(el => el.style.display = '');
          alert('Failed to generate PDF. Please try again.');
        });
    }

    // Dynamic Sections
    let sectionCount = 1;
    function addSection() {
      sectionCount++;
      const template = document.getElementById('section-1').cloneNode(true);
      template.id = 'section-' + sectionCount;
      template.querySelectorAll('input, textarea').forEach(inp => {
        if (inp.type === 'checkbox') inp.checked = false;
        else inp.value = '';
      });
      
      // Update IDs for section-specific elements
      ['single-mat-', 'double-mat-', 'piercustom-', 'piercustominput-', 'piersize-'].forEach(prefix => {
        const el = template.querySelector(`[id^="${prefix}"]`);
        if (el) {
          el.id = prefix + sectionCount;
          const label = template.querySelector(`label[for^="${prefix}"]`);
          if (label) label.htmlFor = el.id;
        }
      });
      
      template.querySelector('.section-title').textContent = 
        'Footing Section / Sección de Cimentación ' + sectionCount;
      
      // Populate hour-select dropdowns in the new section
      const options = generateHourOptions();
      template.querySelectorAll('select.hour-select').forEach(sel => {
        sel.innerHTML = options;
        sel.value = '0';
      });
      
      document.getElementById('sections-container').appendChild(template);
    }
    
    function removeSection(sec) {
      const sections = [...document.querySelectorAll('#sections-container .section')];
      if (sections.length > 1) {
        sec.remove();
        renumberSections();
      } else {
        alert('At least one section is required');
      }
    }
    
    function renumberSections() {
      sectionCount = 0;
      document.querySelectorAll('#sections-container .section').forEach((sec, i) => {
        sectionCount = i + 1;
        sec.id = 'section-' + sectionCount;
        sec.querySelector('.section-title').textContent = 
          'Footing Section / Sección de Cimentación ' + sectionCount;
      });
    }

    // Custom pier size
    function enableCustomInput(cb) {
      const idParts = cb.id.split('-');
      if (idParts.length < 2) return;
      
      const sectionId = idParts[1];
      const inp = document.getElementById('piercustominput-' + sectionId);
      if (inp) {
        inp.disabled = !cb.checked;
        if (!cb.checked) inp.value = '';
      }
    }
    
    function toggleCustomSize(sel) {
      const idParts = sel.id.split('-');
      if (idParts.length < 2) return;
      
      const sectionId = idParts[1];
      const cb = document.getElementById('piercustom-' + sectionId);
      const inp = document.getElementById('piercustominput-' + sectionId);
      
      if (cb && inp) {
        cb.checked = false;
        inp.disabled = true;
        inp.value = '';
      }
    }

    // Crew & Equipment rows
    function addCrewMember() {
      const table = document.getElementById('crew-table');
      const row = table.insertRow(-1);
      row.innerHTML = `
        <td><input type="text"></td>
        <td><input type="text"></td>
        <td><select class="hour-select"></select></td>
      `;
      
      // Populate the new dropdown
      const options = generateHourOptions();
      row.querySelector('select.hour-select').innerHTML = options;
    }
    
    function addEquipmentRow() {
      const table = document.getElementById('equipment-table');
      const row = table.insertRow(-1);
      row.innerHTML = `
        <td><input type="text"></td>
        <td><select class="hour-select"></select></td>
        <td><input type="text"></td>
      `;
      
      // Populate the new dropdown
      const options = generateHourOptions();
      row.querySelector('select.hour-select').innerHTML = options;
    }

    // Single-select helpers
    function updateConcreteCompany(c) {
      document.querySelectorAll('input[name="concrete-company"]').forEach(b => b.checked = false);
      if (c === 'imi' || c === 'srm') {
        document.getElementById(c).checked = true;
        document.getElementById('other-company').value = '';
      }
    }
    
    function updatePumpCompany(c) {
      document.querySelectorAll('input[name="pump-company"]').forEach(b => b.checked = false);
      if (c === 'cpp' || c === 'brundage') {
        document.getElementById('pump-' + c).checked = true;
        document.getElementById('pump-other').value = '';
      }
    }
  </script>
</body>
</html>
