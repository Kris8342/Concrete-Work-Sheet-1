<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Concrete Job Documentation</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
  <style>
    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    }
    
    body {
      background-color: #f5f7fa;
      color: #2d3748;
      line-height: 1.5;
      padding: 10px;
      font-size: 12px;
    }
    
    .container {
      max-width: 1000px;
      margin: 0 auto;
      background: white;
      border-radius: 8px;
      box-shadow: 0 4px 15px rgba(0,0,0,0.08);
      overflow: hidden;
    }
    
    .form-header {
      background: #2c5282;
      color: white;
      padding: 5px 10px;
      text-align: center;
    }
    
    .form-title {
      font-size: 18px;
      font-weight: 600;
      margin: 5px 0;
    }
    
    .form-container {
      padding: 8px;
    }
    
    .form-section {
      margin-bottom: 8px;
      padding-bottom: 8px;
      border-bottom: 1px solid #e2e8f0;
    }
    
    .section-title {
      font-size: 14px;
      font-weight: 600;
      color: #2c5282;
      margin: 0 0 4px 0;
      padding-bottom: 4px;
      border-bottom: 2px solid #cbd5e0;
    }
    
    .grid-2 {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
      gap: 6px;
      margin-bottom: 6px;
    }
    
    .grid-3 {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 6px;
      margin-bottom: 6px;
    }
    
    .input-group {
      margin-bottom: 4px;
    }
    
    label {
      display: block;
      margin-bottom: 2px;
      font-weight: 600;
      color: #4a5568;
      font-size: 12px;
    }
    
    input, select, textarea {
      width: 100%;
      padding: 6px 8px;
      border: 1px solid #cbd5e0;
      border-radius: 6px;
      font-size: 12px;
      transition: all 0.2s ease;
      background-color: #f8fafc;
    }
    
    input:focus, select:focus, textarea:focus {
      outline: none;
      border-color: #4299e1;
      box-shadow: 0 0 0 2px rgba(66, 153, 225, 0.2);
      background-color: white;
    }
    
    textarea {
      min-height: 80px;
      resize: vertical;
    }
    
    .large-textarea {
      min-height: 100px;
    }
    
    table {
      width: 100%;
      border-collapse: collapse;
      margin: 6px 0;
      background: white;
      border-radius: 6px;
      overflow: hidden;
      font-size: 12px;
    }
    
    th {
      background-color: #2c5282;
      color: white;
      font-weight: 500;
      padding: 6px 8px;
      text-align: left;
      font-size: 12px;
    }
    
    td {
      padding: 6px 8px;
      border-bottom: 1px solid #e2e8f0;
      font-size: 12px;
    }
    
    tr:last-child td {
      border-bottom: none;
    }
    
    tr:nth-child(even) {
      background-color: #f8fafc;
    }
    
    .checkbox-group {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
      margin: 6px 0;
    }
    
    .checkbox-item {
      display: flex;
      align-items: center;
      gap: 4px;
      font-size: 12px;
    }
    
    .checkbox-item input {
      width: auto;
    }
    
    .btn {
      padding: 6px 10px;
      border: none;
      border-radius: 6px;
      font-size: 12px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.2s ease;
    }
    
    .btn-primary {
      background: #2b6cb0;
      color: white;
    }
    
    .btn-primary:hover {
      background: #2c5282;
    }
    
    .btn-danger {
      background: #e53e3e;
      color: white;
    }
    
    .btn-danger:hover {
      background: #c53030;
    }
    
    .btn-group {
      display: flex;
      gap: 6px;
      margin-top: 10px;
      flex-wrap: wrap;
    }
    
    .section {
      background: white;
      border: 1px solid #e2e8f0;
      border-radius: 6px;
      padding: 8px;
      margin-bottom: 8px;
    }
    
    .section-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 8px;
    }
    
    .section-number {
      font-size: 14px;
      font-weight: 600;
      color: #2c5282;
    }
    
    .no-print {
      display: inline-block;
    }
    
    .full-width {
      grid-column: 1 / -1;
    }
    
    .counter-group {
      display: flex;
      gap: 4px;
      align-items: center;
    }
    
    .counter-group input {
      width: 60px;
    }
    
    /* Print styles */
    @media print {
      body {
        padding: 0;
        background: white;
        font-size: 10px;
        line-height: 1.2;
      }
      
      .no-print {
        display: none !important;
      }
      
      .container {
        max-width: 100%;
        box-shadow: none;
        border-radius: 0;
        margin: 0;
        padding: 0;
      }
      
      .form-container {
        padding: 5px !important;
      }
      
      .section-title {
        font-size: 12px !important;
        margin-bottom: 4px !important;
      }
      
      .grid-2, .grid-3 {
        display: block;
        margin-bottom: 4px !important;
      }
      
      .input-group {
        margin-bottom: 3px !important;
      }
      
      table {
        font-size: 10px !important;
        margin: 4px 0 !important;
      }
      
      th, td {
        padding: 4px 5px !important;
      }
      
      textarea {
        min-height: 60px !important;
      }
      
      .section {
        padding: 6px !important;
        margin-bottom: 6px !important;
        page-break-inside: avoid;
      }
    }
    
    /* Mobile optimizations */
    @media (max-width: 768px) {
      .form-container {
        padding: 8px;
      }
      
      .grid-2, .grid-3 {
        grid-template-columns: 1fr;
        gap: 6px;
      }
      
      .btn {
        width: 100%;
      }
      
      .btn-group {
        flex-direction: column;
      }
    }
  </style>
</head>
<body>
  <div class="container" id="form-root">
    <div class="form-header">
      <div class="form-title">Concrete Job Documentation</div>
    </div>
    
    <div class="form-container">
      <!-- Job Information -->
      <div class="form-section">
        <h2 class="section-title">Job Information</h2>
        
        <div class="grid-2">
          <div class="input-group">
            <label for="name">Name / Nombre</label>
            <input type="text" id="name">
          </div>
          
          <div class="input-group">
            <label for="date">Date Poured / Fecha Vaciado</label>
            <input type="text" id="date">
          </div>
          
          <div class="input-group full-width">
            <label for="address">Job Address / Dirección del Trabajo</label>
            <input type="text" id="address">
          </div>
          
          <div class="input-group full-width">
            <label for="customer">Customer / Cliente</label>
            <input type="text" id="customer">
          </div>
        </div>
      </div>
      
      <!-- Concrete Sections -->
      <div class="form-section">
        <h2 class="section-title">Concrete Sections</h2>
        
        <div id="sections-container">
          <div class="section" id="section-1">
            <div class="section-header">
              <div class="section-number">Section 1</div>
              <button class="btn btn-danger no-print" onclick="removeSection(this.parentNode.parentNode)">
                Remove Section
              </button>
            </div>
            
            <div class="grid-3">
              <div class="input-group">
                <label>Length (ft) / Largo (pies)</label>
                <input type="number" step="100" min="0">
              </div>
              
              <div class="input-group">
                <label>Width (in) / Ancho (pulg)</label>
                <input type="number" step="6" min="0">
              </div>
              
              <div class="input-group">
                <label>Depth (in) / Profundidad (pulg)</label>
                <input type="number" step="6" min="0">
              </div>
            </div>
            
            <h3 class="section-title" style="font-size: 13px;">Uprights / Verticales</h3>
            <div class="grid-3">
              <div class="input-group">
                <label>Quantity / Cantidad</label>
                <input type="number" step="5" min="0">
              </div>
              
              <div class="input-group">
                <label>Length (ft) / Largo (pies)</label>
                <input type="number" step="1" min="0">
              </div>
            </div>
            
            <h3 class="section-title" style="font-size: 13px;">Crossbars / Travesaños</h3>
            <div class="grid-3">
              <div class="input-group">
                <label>Quantity / Cantidad</label>
                <input type="number" step="5" min="0">
              </div>
              
              <div class="input-group">
                <label>Length (ft) / Largo (pies)</label>
                <input type="number" step="1" min="0">
              </div>
            </div>
            
            <h3 class="section-title" style="font-size: 13px;">Mat Type</h3>
            <div class="checkbox-group">
              <div class="checkbox-item">
                <input type="checkbox" id="single-mat-1">
                <label for="single-mat-1">Single Mat / Malla Simple</label>
              </div>
              <div class="checkbox-item">
                <input type="checkbox" id="double-mat-1">
                <label for="double-mat-1">Double Mat / Malla Doble</label>
              </div>
            </div>
            
            <h3 class="section-title" style="font-size: 13px;">Rebar Details</h3>
            <div class="grid-3">
              <div class="input-group">
                <label>Rebar Qty / Cant. Varilla</label>
                <input type="number" step="10" min="0">
              </div>
              
              <div class="input-group">
                <label>Size / Tamaño</label>
                <select>
                  <option>#4</option>
                  <option>#5</option>
                  <option>#6</option>
                  <option>#7</option>
                  <option>#8</option>
                  <option>#9</option>
                  <option>#10</option>
                </select>
              </div>
            </div>
            
            <h3 class="section-title" style="font-size: 13px;">Bulkheads / Mamparos</h3>
            <div class="grid-3">
              <div class="input-group">
                <label>Qty / Cantidad</label>
                <input type="number" step="1" min="0">
              </div>
              
              <div class="input-group">
                <label>Height / Altura</label>
                <input type="number" step="0.01" min="0">
              </div>
            </div>
            
            <h3 class="section-title" style="font-size: 13px;">Piers / Pilares</h3>
            <div class="grid-3">
              <div class="input-group">
                <label>Qty / Cantidad</label>
                <input type="number" step="1" min="0">
              </div>
              
              <div class="input-group">
                <label>Size / Tamaño</label>
                <select>
                  <option>2' x 2' x 12"</option>
                  <option>3' x 3' x 12"</option>
                </select>
              </div>
            </div>
            
            <h3 class="section-title" style="font-size: 13px;">Additional Elements</h3>
            <div class="grid-2">
              <div class="input-group">
                <label>Fireplace / Chimenea</label>
                <input type="text">
              </div>
              
              <div class="input-group">
                <label>Porch Pad / Base Porche</label>
                <input type="text">
              </div>
            </div>
            
            <div class="input-group">
              <label>Section Notes / Notas Sección</label>
              <textarea class="large-textarea"></textarea>
            </div>
          </div>
        </div>
        
        <div class="btn-group">
          <button class="btn btn-primary no-print" onclick="addSection()">
            Add Section
          </button>
        </div>
      </div>
      
      <!-- Concrete Information -->
      <div class="form-section">
        <h2 class="section-title">Concrete Information</h2>
        
        <div class="grid-2">
          <div class="input-group">
            <label>Concrete Company</label>
            <select id="concrete-company">
              <option value="">Select a company</option>
              <option value="imi">IMI</option>
              <option value="srm">SRM</option>
              <option value="other">Other</option>
            </select>
          </div>
          
          <div class="input-group">
            <label>Other Company</label>
            <input type="text" id="other-company" disabled>
          </div>
          
          <div class="input-group">
            <label>Yards Poured / Yardas Vertidas</label>
            <input type="number" step="10" min="0">
          </div>
          
          <div class="input-group">
            <label>Strength (psi) / Resistencia (psi)</label>
            <select>
              <option>3000</option>
              <option>3500</option>
              <option>4000</option>
              <option>4500</option>
              <option>5000</option>
            </select>
          </div>
        </div>
        
        <div class="input-group">
          <label>Additives / Aditivos</label>
          <input type="text">
        </div>
      </div>
      
      <!-- Equipment & Hours -->
      <div class="form-section">
        <h2 class="section-title">Equipment & Hours</h2>
        
        <table id="equipment-table">
          <thead>
            <tr>
              <th>Equipment / Equipo</th>
              <th>Hours / Horas</th>
              <th>Notes / Notas</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td><input type="text" value="Mini Excavator"></td>
              <td>
                <select class="hour-select">
                  <option>0</option>
                  <option>0.5</option>
                  <option>1.0</option>
                  <option>1.5</option>
                  <option>2.0</option>
                  <option>2.5</option>
                  <option>3.0</option>
                  <option>3.5</option>
                  <option>4.0</option>
                  <option>4.5</option>
                  <option>5.0</option>
                  <option>5.5</option>
                  <option>6.0</option>
                  <option>6.5</option>
                  <option>7.0</option>
                  <option>7.5</option>
                  <option>8.0</option>
                </select>
              </td>
              <td><input type="text"></td>
            </tr>
            <tr>
              <td><input type="text" value="Skid Steer"></td>
              <td>
                <select class="hour-select">
                  <option>0</option>
                  <option>0.5</option>
                  <option>1.0</option>
                  <option>1.5</option>
                  <option>2.0</option>
                  <option>2.5</option>
                  <option>3.0</option>
                  <option>3.5</option>
                  <option>4.0</option>
                  <option>4.5</option>
                  <option>5.0</option>
                  <option>5.5</option>
                  <option>6.0</option>
                  <option>6.5</option>
                  <option>7.0</option>
                  <option>7.5</option>
                  <option>8.0</option>
                </select>
              </td>
              <td><input type="text"></td>
            </tr>
          </tbody>
        </table>
        
        <div class="btn-group">
          <button class="btn btn-primary no-print" onclick="addEquipmentRow()">
            Add Equipment
          </button>
        </div>
      </div>
      
      <!-- Crew Information -->
      <div class="form-section">
        <h2 class="section-title">Crew Information</h2>
        
        <table id="crew-table">
          <thead>
            <tr>
              <th>Name / Nombre</th>
              <th>Role / Rol</th>
              <th>Hours / Horas</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td><input type="text"></td>
              <td><input type="text"></td>
              <td>
                <select class="hour-select">
                  <option>0</option>
                  <option>1</option>
                  <option>2</option>
                  <option>3</option>
                  <option>4</option>
                  <option>5</option>
                  <option>6</option>
                  <option>7</option>
                  <option>8</option>
                  <option>9</option>
                  <option>10</option>
                  <option>11</option>
                  <option>12</option>
                </select>
              </td>
            </tr>
            <tr>
              <td><input type="text"></td>
              <td><input type="text"></td>
              <td>
                <select class="hour-select">
                  <option>0</option>
                  <option>1</option>
                  <option>2</option>
                  <option>3</option>
                  <option>4</option>
                  <option>5</option>
                  <option>6</option>
                  <option>7</option>
                  <option>8</option>
                  <option>9</option>
                  <option>10</option>
                  <option>11</option>
                  <option>12</option>
                </select>
              </td>
            </tr>
          </tbody>
        </table>
        
        <div class="btn-group">
          <button class="btn btn-primary no-print" onclick="addCrewMember()">
            Add Crew Member
          </button>
        </div>
      </div>
      
      <!-- Materials & Lumber -->
      <div class="form-section">
        <h2 class="section-title">Materials & Lumber</h2>
        
        <table>
          <tr>
            <th>Supply / Suministro</th>
            <th>Quantity / Cantidad</th>
          </tr>
          <tr>
            <td>Paint / Pintura</td>
            <td>
              <div class="counter-group">
                <span>Boxes/Cajas:</span>
                <input type="number" min="0">
                <span>Cans/Latas:</span>
                <input type="number" min="0">
              </div>
            </td>
          </tr>
          <tr>
            <td>Chairs (boxes) / Sillas (cajas)</td>
            <td><input type="number" min="0"></td>
          </tr>
          <tr>
            <td>Grade Pins (boxes) / Pines (cajas)</td>
            <td><input type="number" min="0"></td>
          </tr>
          <tr>
            <td>2 × 4 × 16'</td>
            <td><input type="number" min="0"></td>
          </tr>
          <tr>
            <td>Plywood (sheets) / Contrachapado</td>
            <td><input type="number" min="0"></td>
          </tr>
          <tr>
            <td>Lumber Notes / Notas de Madera</td>
            <td><textarea style="height:80px"></textarea></td>
          </tr>
        </table>
      </div>
      
      <!-- Management Job Coding -->
      <div class="form-section">
        <h2 class="section-title">Management Job Coding</h2>
        
        <div class="grid-2">
          <div class="input-group">
            <label>Builder / Constructor</label>
            <input type="text">
          </div>
          
          <div class="input-group">
            <label>City/County / Ciudad</label>
            <input type="text">
          </div>
        </div>
        
        <div class="checkbox-group">
          <div class="checkbox-item">
            <input type="checkbox">
            <label>Turnkey / Llave Mano</label>
          </div>
          <div class="checkbox-item">
            <input type="checkbox">
            <label>House / Casa</label>
          </div>
          <div class="checkbox-item">
            <input type="checkbox">
            <label>Labor Only / Solo O.</label>
          </div>
          <div class="checkbox-item">
            <input type="checkbox">
            <label>Retaining Wall / Muro</label>
          </div>
        </div>
      </div>
      
      <!-- Final Notes -->
      <div class="form-section">
        <h2 class="section-title">Final Notes</h2>
        
        <div class="input-group">
          <label>Additional Notes / Notas Adicionales</label>
          <textarea id="additional-notes" class="large-textarea"></textarea>
        </div>
      </div>
      
      <!-- Action Buttons -->
      <div class="btn-group">
        <button class="btn btn-primary no-print" onclick="savePDF()">
          Save as PDF
        </button>
        <button class="btn no-print" style="background: #4a5568; color: white;" onclick="window.print()">
          Print Form
        </button>
        <button class="btn no-print" style="background: #38a169; color: white;" onclick="clearForm()">
          Clear Form
        </button>
      </div>
    </div>
  </div>

  <script>
    // Set today's date
    document.addEventListener('DOMContentLoaded', function() {
      document.getElementById('date').value = new Date().toLocaleDateString();
      
      // Handle concrete company selection
      document.getElementById('concrete-company').addEventListener('change', function() {
        const otherField = document.getElementById('other-company');
        otherField.disabled = this.value !== 'other';
        if (this.value !== 'other') otherField.value = '';
      });
    });
    
    // Optimized PDF saving function
    function savePDF() {
      // Hide non-printable elements
      const noPrintElements = document.querySelectorAll('.no-print');
      noPrintElements.forEach(el => el.style.display = 'none');

      const element = document.getElementById('form-root');
      
      // Create a clone to preserve original styles
      const clone = element.cloneNode(true);
      clone.style.width = '100%';
      clone.style.overflow = 'visible';
      document.body.appendChild(clone);
      
      const opt = {
        margin: 0.3,
        filename: 'concrete_job_form.pdf',
        pagebreak: { mode: ['avoid-all', 'css'], before: '.form-section' },
        html2canvas: {
          scale: 2,
          useCORS: true,
          scrollY: 0,
          windowHeight: clone.scrollHeight
        },
        jsPDF: { 
          unit: 'in', 
          format: 'letter', 
          orientation: 'portrait',
          hotfixes: ['px_scaling']  // Fixes pixel scaling issues
        }
      };

      // Generate PDF
      html2pdf()
        .set(opt)
        .from(clone)
        .save()
        .then(() => {
          // Clean up and restore UI
          document.body.removeChild(clone);
          noPrintElements.forEach(el => el.style.display = '');
        })
        .catch(err => {
          console.error('PDF generation failed:', err);
          document.body.removeChild(clone);
          noPrintElements.forEach(el => el.style.display = '');
          alert('Failed to generate PDF. Please try again.');
        });
    }
    
    // Clear form function
    function clearForm() {
      if (confirm('Are you sure you want to clear all form data?')) {
        document.querySelectorAll('input:not([type=button]):not([type=submit]), textarea, select').forEach(el => {
          if (el.type === 'checkbox' || el.type === 'radio') {
            el.checked = false;
          } else if (el.tagName === 'SELECT') {
            el.selectedIndex = 0;
          } else {
            el.value = '';
          }
        });
        // Reset date
        document.getElementById('date').value = new Date().toLocaleDateString();
      }
    }
    
    // Add equipment row
    function addEquipmentRow() {
      const table = document.getElementById('equipment-table');
      const row = table.insertRow(-1);
      row.innerHTML = `
        <td><input type="text"></td>
        <td>
          <select class="hour-select">
            <option>0</option>
            <option>0.5</option>
            <option>1.0</option>
            <option>1.5</option>
            <option>2.0</option>
            <option>2.5</option>
            <option>3.0</option>
            <option>3.5</option>
            <option>4.0</option>
            <option>4.5</option>
            <option>5.0</option>
            <option>5.5</option>
            <option>6.0</option>
            <option>6.5</option>
            <option>7.0</option>
            <option>7.5</option>
            <option>8.0</option>
          </select>
        </td>
        <td><input type="text"></td>
      `;
    }
    
    // Add crew member
    function addCrewMember() {
      const table = document.getElementById('crew-table');
      const row = table.insertRow(-1);
      row.innerHTML = `
        <td><input type="text"></td>
        <td><input type="text"></td>
        <td>
          <select class="hour-select">
            <option>0</option>
            <option>1</option>
            <option>2</option>
            <option>3</option>
            <option>4</option>
            <option>5</option>
            <option>6</option>
            <option>7</option>
            <option>8</option>
            <option>9</option>
            <option>10</option>
            <option>11</option>
            <option>12</option>
          </select>
        </td>
      `;
    }
    
    // Section management
    let sectionCount = 1;
    
    function addSection() {
      sectionCount++;
      const template = document.getElementById('section-1').cloneNode(true);
      template.id = 'section-' + sectionCount;
      
      // Clear inputs in the new section
      template.querySelectorAll('input:not([type=button]), textarea, select').forEach(el => {
        if (el.type === 'checkbox') {
          el.checked = false;
        } else {
          el.value = '';
        }
      });
      
      // Update section number
      template.querySelector('.section-number').textContent = `Section ${sectionCount}`;
      
      // Update IDs for section-specific elements
      ['single-mat-', 'double-mat-'].forEach(prefix => {
        const el = template.querySelector(`[id^="${prefix}"]`);
        if (el) {
          el.id = prefix + sectionCount;
          const label = template.querySelector(`label[for^="${prefix}"]`);
          if (label) label.htmlFor = el.id;
        }
      });
      
      document.getElementById('sections-container').appendChild(template);
    }
    
    function removeSection(section) {
      const sections = document.querySelectorAll('.section');
      if (sections.length > 1) {
        section.remove();
      } else {
        alert('You need at least one section');
      }
    }
  </script>
</body>
</html>
