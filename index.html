<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Concrete Job Form</title>
  <style>
    /* ===== BASE STYLES (MOBILE FIRST) ===== */
    :root {
      --spacing-sm: clamp(8px, 2vw, 12px);
      --spacing-md: clamp(12px, 3vw, 18px);
      --spacing-lg: clamp(16px, 4vw, 24px);
      --border-radius: 4px;
      --border-color: #ccc;
      --input-border: 1px solid var(--border-color);
      --primary-color: #2196F3;
      --danger-color: #f44336;
      --success-color: #4CAF50;
    }

    body {
      font-family: Arial, sans-serif;
      line-height: 1.4;
      margin: 0;
      padding: var(--spacing-md);
      color: #333;
      background-color: #f9f9f9;
    }

    /* FORM CONTAINER */
    .form-container {
      width: 100%;
      max-width: 900px;
      margin: 0 auto;
      padding: var(--spacing-md);
      background: white;
      border-radius: var(--border-radius);
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }

    /* HEADER */
    .header {
      display: flex;
      flex-direction: column;
      gap: var(--spacing-md);
      margin-bottom: var(--spacing-lg);
    }

    .input-group {
      display: flex;
      flex-direction: column;
      gap: 4px;
    }

    label {
      font-weight: bold;
      font-size: 0.9rem;
    }

    .input-field {
      padding: var(--spacing-sm);
      border: var(--input-border);
      border-radius: var(--border-radius);
      font-size: 1rem;
      width: 100%;
      box-sizing: border-box;
    }

    /* NUMBER INPUT FIXES */
    .number-input {
      width: 6ch;
      padding-right: 1.5rem;
      text-align: center;
      min-width: 60px;
    }
    input[type="number"]::-webkit-inner-spin-button {
      margin-left: 0.25rem;
    }

    /* TEXTAREAS */
    textarea {
      min-height: 6rem;
      width: 100%;
      resize: vertical;
      padding: 0.5rem;
      font-family: inherit;
      border: var(--input-border);
      border-radius: var(--border-radius);
    }
    #lumber-notes {
      min-height: 6rem;
    }

    /* SECTIONS */
    .section-title {
      font-size: 1.1rem;
      font-weight: bold;
      margin: var(--spacing-lg) 0 var(--spacing-md);
      padding-bottom: var(--spacing-sm);
      border-bottom: 2px solid #333;
    }

    .section {
      background: white;
      border: 1px solid var(--border-color);
      padding: var(--spacing-md);
      margin-bottom: var(--spacing-lg);
      border-radius: var(--border-radius);
    }

    .remove-section {
      background: var(--danger-color);
      color: white;
      border: none;
      border-radius: var(--border-radius);
      padding: var(--spacing-sm) var(--spacing-md);
      cursor: pointer;
      float: right;
      font-size: 0.9rem;
    }

    /* TABLES - MOBILE STACKED LAYOUT */
    table {
      width: 100%;
      border-collapse: collapse;
      margin-bottom: var(--spacing-md);
    }

    th, td {
      border: 1px solid var(--border-color);
      padding: var(--spacing-sm);
      text-align: left;
      display: block;
      width: 100%;
      box-sizing: border-box;
    }

    th {
      background: #f2f2f2;
      font-weight: bold;
    }

    /* INPUTS */
    input[type="text"],
    select {
      width: 100%;
      padding: var(--spacing-sm);
      border: var(--input-border);
      border-radius: var(--border-radius);
      font-size: 1rem;
      box-sizing: border-box;
    }

    /* CHECKBOXES & RADIOS */
    .checkbox-group {
      display: flex;
      flex-direction: column;
      gap: var(--spacing-sm);
      margin-bottom: var(--spacing-md);
    }

    .checkbox-item {
      display: flex;
      align-items: center;
      gap: var(--spacing-sm);
    }

    input[type="checkbox"],
    input[type="radio"] {
      width: 18px;
      height: 18px;
      min-width: 18px;
    }

    /* BUTTONS */
    .btn {
      padding: var(--spacing-md) var(--spacing-lg);
      border: none;
      border-radius: var(--border-radius);
      color: white;
      font-size: 1rem;
      cursor: pointer;
      margin: var(--spacing-sm) var(--spacing-sm) 0 0;
      min-width: 44px;
      min-height: 44px;
    }

    .btn-green {
      background: var(--success-color);
    }

    .btn-blue {
      background: var(--primary-color);
    }

    .btn-toggle {
      background: #607d8b;
      padding: var(--spacing-sm) var(--spacing-md);
      font-size: 0.9rem;
    }

    /* UTILITY CLASSES */
    .no-print {
      display: inline-block;
    }

    /* ===== MEDIUM SCREENS (600px+) ===== */
    @media (min-width: 600px) {
      .header {
        flex-direction: row;
        flex-wrap: wrap;
        gap: var(--spacing-lg);
      }

      .input-group {
        flex: 1 1 calc(50% - var(--spacing-lg));
      }

      /* Address and customer specific */
      #jobAddress {
        flex: 1 1 60%;
      }
      #customerName {
        flex: 1 1 40%;
      }

      .checkbox-group {
        flex-direction: row;
        flex-wrap: wrap;
      }

      /* TABLES - 2 COLUMN LAYOUT */
      table {
        display: table;
      }

      th, td {
        display: table-cell;
      }

      /* SPECIFIC TABLE ADJUSTMENTS */
      #crew-table th,
      #crew-table td {
        width: auto;
      }
    }

    /* ===== LARGE SCREENS (900px+) ===== */
    @media (min-width: 900px) {
      .form-container {
        padding: var(--spacing-lg);
      }

      .header .input-group {
        flex: 1 1 auto;
      }

      /* RESTORE ORIGINAL FIXED WIDTHS FOR DESKTOP */
      .input-field {
        width: 200px;
      }

      /* SPECIFIC TABLE COLUMN WIDTHS */
      table {
        table-layout: auto;
      }

      /* Counter group inputs */
      .counter-group input {
        width: 70px;
      }
    }

    /* ===== PRINT STYLES ===== */
    @media print {
      @page {
        size: letter portrait;
        margin: 0.3in;
      }
      html, body {
        width: 100%;
        height: 100%;
        margin: 0;
        padding: 0;
        font-size: 10px;
        line-height: 1.2;
      }
      .no-print,
      .remove-section,
      .btn-toggle {
        display: none !important;
      }
      .form-container {
        border: none;
        padding: 0;
        margin: 0;
        box-shadow: none;
      }
      table {
        font-size: 9px;
        margin-bottom: 4px;
      }
      th, td {
        padding: 3px;
        display: table-cell;
      }
      label,
      th,
      td,
      input,
      select,
      textarea {
        font-size: 9px !important;
      }
      .section-title {
        font-size: 12px !important;
        margin: 6px 0 4px !important;
        padding-bottom: 2px !important;
      }
      .subsection-title {
        font-size: 11px !important;
        margin: 4px 0 2px !important;
      }
      .input-group,
      .checkbox-group,
      .section {
        margin-bottom: 4px !important;
        padding: 4px !important;
      }
      .counter-group input {
        width: 40px !important;
      }
      textarea {
        height: 50px !important;
      }
      .section {
        page-break-inside: avoid;
      }
      /* Optimized table layout */
      td input,
      td select,
      td textarea {
        width: 100% !important;
        padding: 2px !important;
      }
      .checkbox-item label {
        margin-left: 2px;
      }
    }
  </style>
</head>
<body>
  <div class="form-container" id="form-root" role="form" aria-label="Concrete Job Form">
    <!-- HEADER SECTION -->
    <div class="header">
      <div class="input-group">
        <label for="name">Name / Nombre:</label>
        <input id="name" class="input-field" type="text" placeholder aria-label="Name or Nombre">
      </div>
      <div class="input-group">
        <label for="date">Date Poured / Fecha Vaciado:</label>
        <input id="date" class="input-field" type="text" placeholder aria-label="Date Poured or Fecha Vaciado">
      </div>
      <div class="input-group" id="jobAddress" style="flex:1 1 60%;">
        <label for="address">Job Address / Dirección del Trabajo:</label>
        <input id="address" class="input-field" type="text" placeholder aria-label="Job Address or Dirección del Trabajo">
      </div>
      <div class="input-group" id="customerName" style="flex:1 1 40%;">
        <label for="customer">Customer / Cliente:</label>
        <input id="customer" class="input-field" type="text" placeholder aria-label="Customer or Cliente">
      </div>
    </div>

    <!-- MAIN FORM SECTIONS -->
    <div id="sections-container">
      <div class="section" id="section-1">
        <button class="remove-section no-print" onclick="removeSection(this.parentNode)" aria-label="Remove Footing Section 1" type="button">Remove</button>
        <div class="section-title" id="section-title-1" aria-level="2" role="heading">Footing Section / Sección de Cimentación 1</div>
        
        <!-- DIMENSIONS TABLE -->
        <table>
          <tr>
            <th>Length (ft) / Largo (pies)</th>
            <th>Width (in) / Ancho (pulg)</th>
            <th>Depth (in) / Profundidad (pulg)</th>
          </tr>
          <tr>
            <td>
              <div class="counter-group">
                <input type="number" class="number-input" step="100" min="0" placeholder aria-label="Length in feet" oninput="validateNonNegative(this)">
              </div>
            </td>
            <td>
              <input type="number" class="number-input" step="6" min="0" placeholder aria-label="Width in inches" oninput="validateNonNegative(this)">
            </td>
            <td>
              <input type="number" class="number-input" step="6" min="0" placeholder aria-label="Depth in inches" oninput="validateNonNegative(this)">
            </td>
          </tr>
        </table>

        <!-- UPRIGHTS TABLE -->
        <table>
          <tr>
            <th colspan="2">Uprights / Verticales</th>
            <th>Length (ft) / Largo (pies)</th>
          </tr>
          <tr>
            <td style="width:120px;">Quantity / Cantidad</td>
            <td>
              <input type="number" class="number-input" step="5" min="0" placeholder aria-label="Uprights Quantity" oninput="validateNonNegative(this)">
            </td>
            <td>
              <input type="number" class="number-input" step="1" min="0" placeholder aria-label="Uprights Length in feet" oninput="validateNonNegative(this)">
            </td>
          </tr>
        </table>

        <!-- CROSSBARS TABLE -->
        <table>
          <tr>
            <th colspan="2">Crossbars / Travesaños</th>
            <th>Length (ft) / Largo (pies)</th>
          </tr>
          <tr>
            <td style="width:120px;">Quantity / Cantidad</td>
            <td>
              <input type="number" class="number-input" step="5" min="0" placeholder aria-label="Crossbars Quantity" oninput="validateNonNegative(this)">
            </td>
            <td>
              <input type="number" class="number-input" step="1" min="0" placeholder aria-label="Crossbars Length in feet" oninput="validateNonNegative(this)">
            </td>
          </tr>
        </table>

        <!-- MAT SELECTION -->
        <div class="checkbox-group" role="group" aria-label="Mat Selection Single or Double">
          <div class="checkbox-item">
            <input id="single-mat-1" name="mat-type-1" type="radio" aria-label="Single Mat / Malla Simple">
            <label for="single-mat-1">Single Mat / Malla Simple</label>
          </div>
          <div class="checkbox-item">
            <input id="double-mat-1" name="mat-type-1" type="radio" aria-label="Double Mat / Malla Doble">
            <label for="double-mat-1">Double Mat / Malla Doble</label>
          </div>
        </div>

        <!-- REBAR TABLE -->
        <table>
          <tr>
            <th>Rebar Qty / Cant. Varilla</th>
            <th>Size / Tamaño</th>
          </tr>
          <tr>
            <td>
              <div class="counter-group">
                <input type="number" class="number-input" step="10" min="0" placeholder aria-label="Rebar Quantity" oninput="validateNonNegative(this)">
              </div>
            </td>
            <td>
              <select aria-label="Rebar Size">
                <option value>Select Size</option>
                <option>#4</option>
                <option>#5</option>
                <option>#6</option>
                <option>#7</option>
                <option>#8</option>
                <option>#9</option>
                <option>#10</option>
              </select>
            </td>
          </tr>
        </table>

        <!-- BULKHEADS TABLE -->
        <table>
          <tr>
            <th>Bulkheads / Mamparos</th>
            <th>Qty / Cantidad</th>
            <th>Height / Altura</th>
          </tr>
          <tr>
            <td></td>
            <td>
              <input type="number" class="number-input" step="1" min="0" placeholder aria-label="Bulkheads Quantity" oninput="validateNonNegative(this)">
            </td>
            <td>
              <input type="number" class="number-input" step="0.01" min="0" placeholder aria-label="Bulkheads Height" oninput="validateNonNegative(this)">
            </td>
          </tr>
        </table>

        <!-- PIERS TABLE -->
        <table>
          <tr>
            <th>Piers Qty / Cant. Pilares</th>
            <th>Size / Tamaño</th>
            <th>Custom / Pers.</th>
          </tr>
          <tr>
            <td>
              <input type="number" class="number-input" step="1" min="0" placeholder aria-label="Piers Quantity" oninput="validateNonNegative(this)">
            </td>
            <td>
              <select id="piersize-1" aria-label="Pier Size" onchange="toggleCustomSize(this)">
                <option value>Select Size</option>
                <option>2' x 2' x 12"</option>
                <option>3' x 3' x 12"</option>
              </select>
            </td>
            <td class="checkbox-item">
              <input type="checkbox" id="piercustom-1" aria-label="Custom Size / Tamaño Pers." onchange="enableCustomInput(this)">
              <label for="piercustom-1">Custom Size / Tamaño Pers.</label>
              <input type="text" id="piercustominput-1" disabled style="width:120px" placeholder aria-label="Custom Pier Size Input">
            </td>
          </tr>
        </table>

        <!-- FIREPLACE AND PORCH PAD -->
        <div class="subsection-title">Fireplace / Chimenea</div>
        <input type="text" style="width:100%;margin-bottom:10px" placeholder aria-label="Fireplace or Chimenea">
        
        <div class="subsection-title">Porch Pad / Base Porche</div>
        <input type="text" style="width:100%;margin-bottom:10px" placeholder aria-label="Porch Pad or Base Porche">

        <!-- ADDITIONAL MATERIALS -->
        <div class="subsection-title">Additional Materials / Materiales Ad.</div>
        <table>
          <tr>
            <th>Item / Artículo</th>
            <th>Qty / Cantidad</th>
            <th>Notes / Notas</th>
          </tr>
          <tr>
            <td><input type="text" placeholder aria-label="Additional Material Item 1"></td>
            <td><input type="number" class="number-input" step="2" min="0" placeholder aria-label="Additional Material Quantity 1" oninput="validateNonNegative(this)"></td>
            <td><input type="text" placeholder aria-label="Additional Material Notes 1"></td>
          </tr>
          <tr>
            <td><input type="text" placeholder aria-label="Additional Material Item 2"></td>
            <td><input type="number" class="number-input" step="1" min="0" placeholder aria-label="Additional Material Quantity 2" oninput="validateNonNegative(this)"></td>
            <td><input type="text" placeholder aria-label="Additional Material Notes 2"></td>
          </tr>
          <tr>
            <td><input type="text" placeholder aria-label="Additional Material Item 3"></td>
            <td><input type="number" class="number-input" step="1" min="0" placeholder aria-label="Additional Material Quantity 3" oninput="validateNonNegative(this)"></td>
            <td><input type="text" placeholder aria-label="Additional Material Notes 3"></td>
          </tr>
        </table>

        <!-- SECTION NOTES -->
        <div class="subsection-title">Section Notes / Notas Sección</div>
        <textarea placeholder aria-label="Section Notes"></textarea>
      </div>
    </div>

    <!-- ADD SECTION BUTTON -->
    <button class="btn btn-blue no-print" onclick="addSection()" type="button" aria-label="Add Footing Section">Add Section / Agregar Sección</button>
    
    <!-- SECTION COUNT -->
    <div class="section-title" aria-level="2" role="heading">Number of Sections / Número de Secciones:</div>
    <div class="checkbox-group" id="section-count-group" role="radiogroup" aria-label="Number of Sections"></div>

    <!-- CONCRETE INFO -->
    <div class="section-title" aria-level="2" role="heading">Concrete Info / Info de Concreto</div>
    <div class="checkbox-group" role="radiogroup" aria-label="Concrete Company">
      <div class="checkbox-item">
        <input id="imi" name="concrete-company" type="radio" onclick="updateConcreteCompany('imi')" aria-label="IMI Concrete Company">
        <label for="imi">IMI</label>
      </div>
      <div class="checkbox-item">
        <input id="srm" name="concrete-company" type="radio" onclick="updateConcreteCompany('srm')" aria-label="SRM Concrete Company">
        <label for="srm">SRM</label>
      </div>
      <div class="input-group" style="flex:1;">
        <label for="other-company">Other / Otro:</label>
        <input id="other-company" class="input-field" type="text" oninput="updateConcreteCompany('other')" placeholder aria-label="Other Concrete Company">
      </div>
    </div>
    
    <!-- YARDS POURED -->
    <table>
      <tr>
        <th>Yards Poured / Yardas Vertidas</th>
      </tr>
      <tr>
        <td>
          <div class="counter-group">
            <input id="yards-tens" type="number" class="number-input" step="10" min="0" placeholder aria-label="Yards Poured" oninput="validateNonNegative(this)">
          </div>
        </td>
      </tr>
    </table>
    
    <!-- ADDITIVES -->
    <table>
      <tr>
        <th>Additives / Aditivos</th>
        <th>Strength (psi) / Resistencia (psi)</th>
      </tr>
      <tr>
        <td><input id="additives" class="input-field" type="text" style="width:100%" placeholder aria-label="Additives"></td>
        <td><input id="strength" type="number" class="number-input" step="500" min="3000" placeholder aria-label="Strength PSI" oninput="validateMinValue(this,3000)"></td>
      </tr>
    </table>

    <!-- PUMP COMPANY -->
    <div class="section-title" aria-level="2" role="heading">Pump Co. / Empresa Bomba</div>
    <div class="checkbox-group" role="radiogroup" aria-label="Pump Company">
      <div class="checkbox-item">
        <input id="pump-cpp" name="pump-company" type="radio" onclick="updatePumpCompany('cpp')" aria-label="CPP Pump Company">
        <label for="pump-cpp">CPP</label>
      </div>
      <div class="checkbox-item">
        <input id="pump-brundage" name="pump-company" type="radio" onclick="updatePumpCompany('brundage')" aria-label="Brundage Pump Company">
        <label for="pump-brundage">Brundage</label>
      </div>
      <div class="input-group" style="flex:1;">
        <label for="pump-other">Other / Otro:</label>
        <input id="pump-other" class="input-field" type="text" oninput="updatePumpCompany('other')" placeholder aria-label="Other Pump Company">
      </div>
    </div>

    <!-- CREW INFO (Toggleable) -->
    <div class="section-title" aria-level="2" role="heading">
      Crew Info / Info del Equipo
      <button class="btn btn-toggle no-print" onclick="toggleSection('crew-section')" type="button">Hide</button>
    </div>
    <div id="crew-section" class="toggle-target">
      <table id="crew-table" aria-label="Crew Information">
        <tr>
          <th>Name / Nombre</th>
          <th>Role / Rol</th>
          <th>Hours / Horas</th>
        </tr>
        <tr>
          <td><input type="text" placeholder aria-label="Crew Member Name"></td>
          <td><input type="text" placeholder aria-label="Crew Member Role"></td>
          <td><input type="number" class="number-input" step="0.5" placeholder aria-label="Crew Member Hours" oninput="validateNonNegative(this)"></td>
        </tr>
        <tr>
          <td><input type="text" placeholder aria-label="Crew Member Name"></td>
          <td><input type="text" placeholder aria-label="Crew Member Role"></td>
          <td><input type="number" class="number-input" step="0.5" placeholder aria-label="Crew Member Hours" oninput="validateNonNegative(this)"></td>
        </tr>
        <tr>
          <td><input type="text" placeholder aria-label="Crew Member Name"></td>
          <td><input type="text" placeholder aria-label="Crew Member Role"></td>
          <td><input type="number" class="number-input" step="0.5" placeholder aria-label="Crew Member Hours" oninput="validateNonNegative(this)"></td>
        </tr>
      </table>
      <button class="btn btn-blue no-print" onclick="addCrewMember()" type="button" aria-label="Add Crew Member">Add Crew Member / Agregar Miembro</button>
    </div>

    <!-- EQUIPMENT HOURS -->
    <div class="section-title" aria-level="2" role="heading">Equipment Hours & Description / Horas y Descripción</div>
    <table aria-label="Equipment Hours and Description">
      <tr>
        <th>Equipment</th>
        <th>Hours</th>
        <th>Description</th>
      </tr>
      <tr>
        <td>MiniX</td>
        <td><input type="number" class="number-input" step="0.5" placeholder aria-label="MiniX Hours" oninput="validateNonNegative(this)"></td>
        <td><input type="text" placeholder aria-label="MiniX Description"></td>
      </tr>
      <tr>
        <td>Hammer</td>
        <td><input type="number" class="number-input" step="0.5" placeholder aria-label="Hammer Hours" oninput="validateNonNegative(this)"></td>
        <td><input type="text" placeholder aria-label="Hammer Description"></td>
      </tr>
      <tr>
        <td>Skid / Dingo</td>
        <td><input type="number" class="number-input" step="0.5" placeholder aria-label="Skid or Dingo Hours" oninput="validateNonNegative(this)"></td>
        <td><input type="text" placeholder aria-label="Skid or Dingo Description"></td>
      </tr>
      <tr>
        <td>Step Pad</td>
        <td><input type="number" class="number-input" step="0.5" placeholder aria-label="Step Pad Hours" oninput="validateNonNegative(this)"></td>
        <td><input type="text" placeholder aria-label="Step Pad Description"></td>
      </tr>
    </table>

    <!-- SUPPLIES USED -->
    <div class="section-title" aria-level="2" role="heading">Supplies Used / Suministros Usados</div>
    <table aria-label="Supplies Used">
      <tr>
        <th>Supply / Suministro</th>
        <th>Quantity / Notas</th>
      </tr>
      <tr>
        <td>Paint / Pintura</td>
        <td>
          Boxes/Cajas <input type="number" class="number-input" placeholder aria-label="Paint Boxes Quantity" oninput="validateNonNegative(this)">
          Cans/Latas <input type="number" class="number-input" placeholder aria-label="Paint Cans Quantity" oninput="validateNonNegative(this)">
        </td>
      </tr>
      <tr>
        <td>Chairs (boxes) / Sillas (cajas)</td>
        <td><input type="number" class="number-input" placeholder aria-label="Chairs Boxes Quantity" oninput="validateNonNegative(this)"></td>
      </tr>
      <tr>
        <td>Grade Pins (boxes) / Pines (cajas)</td>
        <td><input type="number" class="number-input" placeholder aria-label="Grade Pins Boxes Quantity" oninput="validateNonNegative(this)"></td>
      </tr>
      <tr>
        <td>2 × 4 × 16'</td>
        <td><input type="number" class="number-input" placeholder aria-label="2x4x16 Quantity" oninput="validateNonNegative(this)"></td>
      </tr>
      <tr>
        <td>Plywood (sheets) / Contrachapado</td>
        <td><input type="number" class="number-input" placeholder aria-label="Plywood Sheets Quantity" oninput="validateNonNegative(this)"></td>
      </tr>
      <tr>
        <td>Lumber Notes / Notas de Madera</td>
        <td><textarea id="lumber-notes" placeholder aria-label="Lumber Notes"></textarea></td>
      </tr>
    </table>

    <!-- MANAGEMENT JOB CODING (Toggleable) -->
    <div class="section-title" aria-level="2" role="heading">
      Management Job Coding / Cod. Gestión
      <button class="btn btn-toggle no-print" onclick="toggleSection('coding-section')" type="button">Hide</button>
    </div>
    <div id="coding-section" class="toggle-target">
      <div class="input-group">
        <label for="builder">Builder / Constructor:</label>
        <input id="builder" class="input-field" type="text" placeholder aria-label="Builder or Constructor">
      </div>
      <div class="input-group">
        <label for="city-county">City/County / Ciudad:</label>
        <input id="city-county" class="input-field" type="text" placeholder aria-label="City or County">
      </div>
      <div class="checkbox-group" role="group" aria-label="Job Type">
        <div class="checkbox-item">
          <input id="job-turnkey" type="checkbox" aria-label="Turnkey Job">
          <label for="job-turnkey">Turnkey / Llave Mano</label>
        </div>
        <div class="checkbox-item">
          <input id="job-house" type="checkbox" aria-label="House Job">
          <label for="job-house">House / Casa</label>
        </div>
        <div class="checkbox-item">
          <input id="job-labor" type="checkbox" aria-label="Labor Only Job">
          <label for="job-labor">Labor Only / Solo O.</label>
        </div>
        <div class="checkbox-item">
          <input id="job-retaining" type="checkbox" aria-label="Retaining Wall Job">
          <label for="job-retaining">Retaining Wall / Muro</label>
        </div>
      </div>
    </div>

    <!-- ADDITIONAL NOTES (Toggleable) -->
    <div class="section-title" aria-level="2" role="heading">
      Additional Notes / Notas Adicionales
      <button class="btn btn-toggle no-print" onclick="toggleSection('notes-section')" type="button">Hide</button>
    </div>
    <div id="notes-section" class="toggle-target">
      <textarea id="additional-notes" placeholder aria-label="Additional Notes"></textarea>
    </div>

    <!-- SAVE AS PDF -->
    <button class="btn btn-green no-print" onclick="savePDF()" type="button" aria-label="Save form as PDF">Save as PDF / Guardar PDF</button>
  </div>

  <!-- html2pdf bundle -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
  <script>
    // Set today's date
    document.getElementById('date').value = new Date().toLocaleDateString();

    // Enter key navigation (skipping textarea)
    document.addEventListener('keydown', (e) => {
      if (e.key === 'Enter' && e.target.tagName !== 'TEXTAREA') {
        e.preventDefault();
        const fields = [...document.querySelectorAll('input:not([type=checkbox]), select, textarea')].filter((el) => el.offsetParent);
        const idx = fields.indexOf(document.activeElement);
        (fields[idx + 1] || fields[0]).focus();
      }
    });

    // Validate number inputs to prevent negative or invalid values
    function validateNonNegative(input) {
      if (input.value !== '' && Number(input.value) < 0) {
        input.value = '';
      }
    }
    // Validate minimum value for inputs such as strength psi
    function validateMinValue(input, min) {
      if (input.value !== '' && Number(input.value) < min) {
        input.value = '';
      }
    }

    // Toggle section visibility
    function toggleSection(id) {
      const el = document.getElementById(id);
      if(!el) return;
      el.style.display = (el.style.display === 'none') ? '' : 'none';
    }

    // --- SAVE PDF ---
    function savePDF() {
      // Hide non-printable elements
      const ui = document.querySelectorAll('.no-print');
      ui.forEach((el) => (el.style.display = 'none'));

      const element = document.getElementById('form-root');

      // Clone element to preserve original styles
      const clone = element.cloneNode(true);
      clone.style.width = '100%';
      clone.style.overflow = 'visible';
      document.body.appendChild(clone);

      // Inject print-safe styles into clone
      const style = document.createElement('style');
      style.textContent = `
        input, select, textarea {
          background-color: #fff !important;
          color: #000 !important;
          border: 1px solid #ccc !important;
          box-shadow: none !important;
        }
        .input-field {
          background-color: #fff !important;
          border: 1px solid #ccc !important;
        }
        * {
          margin-bottom: 2px !important;
          padding: 2px !important;
          line-height: 1.1 !important;
          font-size: 9px !important;
        }
      `;
      clone.appendChild(style);

      const opt = {
        margin: 0.2,
        filename: 'concrete_job_form.pdf',
        pagebreak: { mode: ['avoid-all', 'css'], before: '.section' },
        html2canvas: {
          scale: 2,
          useCORS: true,
          scrollY: 0,
          windowHeight: clone.scrollHeight
        },
        jsPDF: {
          unit: 'in',
          format: 'letter',
          orientation: 'portrait',
          hotfixes: ['px_scaling']
        }
      };

      html2pdf()
        .set(opt)
        .from(clone)
        .save()
        .then(() => {
          document.body.removeChild(clone);
          ui.forEach((el) => (el.style.display = ''));
        })
        .catch((err) => {
          console.error('PDF generation failed:', err);
          if (document.body.contains(clone)) {
            document.body.removeChild(clone);
          }
          ui.forEach((el) => (el.style.display = ''));
          alert('Failed to generate PDF. Please try again.');
        });
    }

    // --- DYNAMIC SECTIONS (as in the original) ---
    let sectionCount = 1;

    // Generate radio buttons showing the current section count
    function updateSectionCountRadios() {
      const container = document.getElementById('section-count-group');
      container.innerHTML = '';
      for (let i = 1; i <= sectionCount; i++) {
        const id = 'section-count-' + i;
        const radio = document.createElement('input');
        radio.type = 'radio';
        radio.name = 'section-count';
        radio.id = id;
        radio.value = i;
        radio.setAttribute('aria-label', `Select ${i} sections`);
        radio.onclick = () => updateSectionCount(i);
        if (i === sectionCount) radio.checked = true;

        const label = document.createElement('label');
        label.htmlFor = id;
        label.textContent = i;

        const div = document.createElement('div');

        div.className = 'checkbox-item';
        div.appendChild(radio);
        div.appendChild(label);

        container.appendChild(div);
      }
    }

    // Add a new footing section
    function addSection() {
      sectionCount++;
      const t = document.getElementById('section-1').cloneNode(true);
      t.id = 'section-' + sectionCount;
      t.querySelectorAll('input,textarea,select').forEach((el) => {
        if (el.type === 'checkbox' || el.type === 'radio') el.checked = false;
        else el.value = '';
        if (el.tagName === 'SELECT') el.selectedIndex = 0;
      });
      // Update IDs for mat and pier inputs to avoid duplicates in the clone
      ['single-mat-', 'double-mat-', 'piercustom-', 'piercustominput-', 'piersize-'].forEach(
        (pref) => {
          const el = t.querySelector('[id^="' + pref + '"]');
          if (el) {
            el.id = pref + sectionCount;
            if (el.type === 'radio') {
              el.name = 'mat-type-' + sectionCount;
            }
            const lbl = t.querySelector('label[for^="' + pref + '"]');
            if (lbl) lbl.htmlFor = el.id;
          }
        }
      );
      t.querySelector('.section-title').textContent = 'Footing Section / Sección de Cimentación ' + sectionCount;

      // Update aria-label on remove button
      const removeBtn = t.querySelector('.remove-section');
      removeBtn.setAttribute('aria-label', `Remove Footing Section ${sectionCount}`);
      
      // Update section title aria attributes
      const sectionTitle = t.querySelector('.section-title');
      sectionTitle.id = 'section-title-' + sectionCount;

      document.getElementById('sections-container').appendChild(t);
      updateSectionCountRadios();
    }

    // Remove a footing section (ensure at least one remains)
    function removeSection(sec) {
      const all = [...document.querySelectorAll('#sections-container .section')];
      if (all.length === 1) {
        alert('At least one section is required');
        return;
      }
      if (!confirm('Are you sure you want to remove this section?')) return;
      sec.remove();
      renumber();
    }

    // Renumber sections after removal
    function renumber() {
      sectionCount = 0;
      document.querySelectorAll('#sections-container .section').forEach((s, i) => {
        sectionCount = i + 1;
        s.id = 'section-' + sectionCount;
        s.querySelector('.section-title').textContent = 'Footing Section / Sección de Cimentación ' + sectionCount;
        const removeBtn = s.querySelector('.remove-section');
        if (removeBtn) {
          removeBtn.setAttribute('aria-label', `Remove Footing Section ${sectionCount}`);
        }
        ['single-mat-', 'double-mat-', 'piercustom-', 'piercustominput-', 'piersize-'].forEach(
          (pref) => {
            const el = s.querySelector('[id^="' + pref + '"]');
            if (el) {
              el.id = pref + sectionCount;
              if (el.type === 'radio') {
                el.name = 'mat-type-' + sectionCount;
              }
              const lbl = s.querySelector('label[for^="' + pref + '"]');
              if (lbl) lbl.htmlFor = el.id;
            }
          }
        );
        const sectionTitle = s.querySelector('.section-title');
        sectionTitle.id = 'section-title-' + sectionCount;
      });
      updateSectionCountRadios();
    }

    function updateSectionCount(n) {
      document.querySelectorAll('input[name="section-count"]').forEach((c) => (c.checked = false));
      const radio = document.getElementById('section-count-' + n);
      if (radio) radio.checked = true;
      while (sectionCount < n) addSection();
      while (sectionCount > n) {
        if (sectionCount === 1) break;
        document.querySelector('#sections-container .section:last-child').remove();
        sectionCount--;
      }
      updateSectionCountRadios();
    }

    // Custom pier size helpers
    function enableCustomInput(cb) {
      const i = cb.id.split('-')[1];
      const inp = document.getElementById('piercustominput-' + i);
      inp.disabled = !cb.checked;
      if (!cb.checked) inp.value = '';
    }
    function toggleCustomSize(sel) {
      const i = sel.id.split('-')[1];
      const cb = document.getElementById('piercustom-' + i);
      const inp = document.getElementById('piercustominput-' + i);
      cb.checked = false;
      inp.disabled = true;
      inp.value = '';
    }

    // Crew & Equipment rows helpers
    function addCrewMember() {
      const r = document.getElementById('crew-table').insertRow(-1);
      r.innerHTML = '<td><input type="text" placeholder="" aria-label="Crew Member Name" /></td>' +
                    '<td><input type="text" placeholder="" aria-label="Crew Member Role" /></td>' +
                    '<td><input type="number" class="number-input" step="0.5" placeholder="" aria-label="Crew Member Hours" oninput="validateNonNegative(this)" /></td>';
    }

    // Single-select helpers for concrete company
    function updateConcreteCompany(c) {
      if (c === 'imi' || c === 'srm') {
        document.getElementById(c).checked = true;
        document.getElementById('other-company').value = '';
      }
    }
    // Single-select helpers for pump company
    function updatePumpCompany(c) {
      if (c === 'cpp' || c === 'brundage') {
        document.getElementById('pump-' + c).checked = true;
        document.getElementById('pump-other').value = '';
      }
    }

    // Initialize section count radios on page load
    updateSectionCountRadios();
  </script>
</body>
</html>
